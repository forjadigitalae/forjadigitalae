<!DOCTYPE html>
<html lang="es">
<head>
	<meta name="referrer" content="no-referrer">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluaci√≥n de Madurez Empresarial - ForjaDigitalAE</title>
    <meta name="description" content="Eval√∫a gratis el nivel de madurez de tu PYME. Recibe un reporte profesional con recomendaciones personalizadas en 15 minutos.">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        /* Design System - Variables CSS con nueva paleta corporativa */
        :root {
            /* Primary Brand Colors */
            --primary-900: #27325A;
            --primary-700: #33487A;
            --primary-500: #55688A;
            --primary-300: #A3B2D9;
            --primary-50: #F0F4F8;
            
            /* Accent Colors */
            --accent-purple: #8560C0;
            --accent-orange: #EE8028;
            --accent-turquoise: #4CCED5;
            --accent-red: #AA2F0C;
            --accent-orange-light: #EC8E48;
            --accent-blue-dark: #1D1A70;
            --accent-blue-night: #152E57;
            --accent-turquoise-light: #73CFCE;
            
            /* Status Colors */
            --success-500: #10b981;
            --warning-500: #f59e0b;
            --error-500: #ef4444;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, var(--accent-blue-night) 0%, var(--accent-purple) 100%);
            --gradient-accent: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-turquoise) 100%);
            --gradient-energy: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-orange-light) 100%);
            --gradient-innovation: linear-gradient(135deg, var(--accent-blue-dark) 0%, var(--accent-turquoise) 100%);
            
            /* Scale Colors */
            --scale-1: #AA2F0C;
            --scale-2: #EC8E48;
            --scale-3: #EE8028;
            --scale-4: #4CCED5;
            --scale-5: #10b981; /* Cambiado a verde para Muy Alto/Excelente */
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);

            /* Estilos de Interfaz3 */
            --azul-marino: #27325A;
            --azul-secundario: #33487A;
            --purpura-innovacion: #8560C0;
            --naranja-energia: #EE8028;
            --turquesa-digital: #4CCED5;
            --rojo-forja: #AA2F0C;
            --naranja-suave: #EC8E48;
            --azul-profundo: #1D1A70;
            --azul-noche: #152E57;
            --turquesa-claro: #73CFCE;
            
            --degradado-principal: linear-gradient(135deg, var(--azul-noche) 0%, var(--purpura-innovacion) 100%);
            --degradado-energia: linear-gradient(135deg, var(--naranja-energia) 0%, var(--naranja-suave) 100%);
            --degradado-innovacion: linear-gradient(135deg, var(--purpura-innovacion) 0%, var(--turquesa-digital) 100%);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--primary-900);
            background: var(--primary-50);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Estilos de Landing Page (Interfaz3) */
        #landing {
            background-color: var(--azul-marino);
            color: white;
            overflow: hidden;
            height: 100vh;
        }
        
        .contenedor-principal {
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .fondo-dinamico {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }

        .orbita {
            position: absolute;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: rotar-orbita linear infinite;
        }

        .orbita-1 { width: 80vw; height: 80vw; top: -40vw; left: -20vw; animation-duration: 120s; }
        .orbita-2 { width: 60vw; height: 60vw; bottom: -30vw; right: -15vw; animation-duration: 100s; animation-direction: reverse; }

        .punto-orbita { position: absolute; width: 12px; height: 12px; border-radius: 50%; background: var(--turquesa-digital); animation: brillo-punto 3s ease-in-out infinite alternate; }
        .punto-1 { top: 30%; left: 30%; background: var(--naranja-energia); }
        .punto-2 { top: 60%; left: 70%; background: var(--purpura-innovacion); animation-delay: 0.5s; }
        .punto-3 { top: 20%; left: 80%; background: var(--turquesa-digital); animation-delay: 1s; }

        .linea-curva { position: absolute; height: 200px; width: 400px; border: 2px solid rgba(255, 255, 255, 0.05); border-top: none; border-right: none; border-radius: 0 0 0 100%; bottom: 0; right: 0; }
        .linea-curva-2 { top: 20%; left: 10%; transform: rotate(180deg); border-color: rgba(255, 255, 255, 0.03); }

        @keyframes rotar-orbita { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes brillo-punto { from { opacity: 0.4; transform: scale(0.8); } to { opacity: 1; transform: scale(1.1); box-shadow: 0 0 15px currentColor; } }

        .contenido-principal {
            position: relative; z-index: 2; display: flex; flex-direction: column;
            justify-content: center; align-items: center; height: 100%;
            padding: 2rem; text-align: center;
        }

        .logo { max-width: 280px; margin-bottom: 2rem; filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3)); }
        
        .titulo-principal {
            font-size: 3.2rem; font-weight: 800; margin-bottom: 1.5rem;
            background: linear-gradient(to right, white, var(--turquesa-claro));
            -webkit-background-clip: text; background-clip: text; color: transparent;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
        }

        .subtitulo { font-size: 1.3rem; max-width: 600px; margin-bottom: 3rem; opacity: 0.9; line-height: 1.6; }

        .boton-principal {
            background: var(--degradado-energia); color: white; border: none; padding: 1.2rem 2.8rem;
            font-size: 1.2rem; font-weight: 600; border-radius: 50px; cursor: pointer;
            transition: all 0.3s ease; box-shadow: var(--shadow-md); position: relative; overflow: hidden;
        }
        .boton-principal:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); }

        .contenedor-tarjetas { position: relative; z-index: 2; padding: 2rem; display: flex; justify-content: center; gap: 2rem; }

        .tarjeta-landing {
            background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
            padding: 2rem; width: 320px; text-align: center;
            transition: all 0.4s ease; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .tarjeta-landing:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.12); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3); }

        .icono-tarjeta {
            font-size: 3.5rem; margin-bottom: 1.5rem; display: block;
            background: var(--degradado-innovacion);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        .titulo-tarjeta { font-size: 1.4rem; margin-bottom: 1rem; color: white; font-weight: 600; }
        .texto-tarjeta { font-size: 1rem; opacity: 0.85; line-height: 1.6; }


        /* Patr√≥n de fondo para otras secciones */
        body.section-view::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(115, 207, 206, 0.15) 0px, transparent 50px),
                radial-gradient(circle at 85% 30%, rgba(133, 96, 192, 0.1) 0px, transparent 40px),
                radial-gradient(circle at 40% 80%, rgba(238, 128, 40, 0.1) 0px, transparent 45px);
            background-size: 100% 100%;
            z-index: -1;
            pointer-events: none;
        }


        /* Typography */
        .text-display { font-size: 3.5rem; font-weight: 800; line-height: 1.1; }
        .text-h1 { font-size: 2.5rem; font-weight: 700; line-height: 1.2; }
        .text-h2 { font-size: 2rem; font-weight: 600; line-height: 1.3; }
        .text-h3 { font-size: 1.5rem; font-weight: 600; line-height: 1.4; }
        .text-body-lg { font-size: 1.125rem; font-weight: 400; line-height: 1.6; }
        .text-body { font-size: 1rem; font-weight: 400; line-height: 1.5; }

        /* Layout Components */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .section { padding: 4rem 0; position: relative; }

        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .text-center { text-align: center; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-8 { margin-top: 2rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }

        /* Button Styles */
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
            border: none; font-size: 1rem; min-height: 48px;
        }
        .btn-primary { background: var(--gradient-accent); color: white; box-shadow: var(--shadow-md); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-secondary { background: var(--gradient-energy); color: white; box-shadow: var(--shadow-md); }
        .btn-secondary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-outline { background: white; color: var(--primary-700); border: 2px solid var(--primary-300); }
        .btn-outline:hover { background: var(--primary-50); border-color: var(--primary-500); }
        .btn-lg { padding: 1rem 2rem; font-size: 1.125rem; }

        /* Card Styles */
        .card {
            background: white; border-radius: 1rem; box-shadow: var(--shadow-md);
            border: 1px solid var(--primary-300); overflow: hidden; position: relative;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0;
            height: 4px; background: var(--gradient-innovation);
        }
        .card-body { padding: 1.5rem; }

        /* Form Styles */
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-weight: 600; color: var(--primary-700); margin-bottom: 0.5rem; font-size: 0.9rem; }
        .form-input { width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--primary-300); border-radius: 0.5rem; font-size: 1rem; transition: all 0.3s ease; }
        .form-input:focus { outline: none; border-color: var(--accent-purple); box-shadow: 0 0 0 3px rgba(133, 96, 192, 0.2); }
        .form-select { width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--primary-300); border-radius: 0.5rem; font-size: 1rem; background: white; cursor: pointer; }

        /* Progress Bar */
        .progress-bar { width: 100%; height: 12px; background: var(--primary-300); border-radius: 6px; overflow: hidden; margin: 1rem 0; }
        .progress-fill { height: 100%; background: var(--gradient-accent); transition: width 0.5s ease; border-radius: 6px; }

        /* Scale Options */
        .scale-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem; margin: 2rem 0; }
        .scale-option { padding: 1rem; border: 2px solid var(--primary-300); border-radius: 0.75rem; text-align: center; cursor: pointer; transition: all 0.3s ease; background: white; }
        .scale-option:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .scale-option.selected { border-color: var(--accent-purple); background: rgba(133, 96, 192, 0.1); }
        .scale-number {
            display: block; width: 32px; height: 32px; margin: 0 auto 0.5rem;
            border-radius: 50%; background: var(--primary-500); color: white; font-weight: 600;
            display: flex; align-items: center; justify-content: center;
        }
        .scale-option.selected .scale-number { background: var(--accent-purple); }
        .scale-label { font-size: 0.875rem; color: var(--primary-700); font-weight: 500; }

        /* Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); z-index: 1000; display: flex;
            align-items: center; justify-content: center; backdrop-filter: blur(4px);
        }
        .modal-content {
            background: white; border-radius: 1rem; max-width: 600px; max-height: 90vh;
            overflow-y: auto; box-shadow: var(--shadow-lg); margin: 1rem; position: relative;
        }
        .modal-content::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px;
            background: var(--gradient-innovation); border-radius: 1rem 1rem 0 0;
        }
        .modal-header { padding: 2rem; text-align: center; border-bottom: 1px solid var(--primary-300); }
        .modal-body { padding: 2rem; }
        .modal-footer { padding: 1.5rem 2rem; border-top: 1px solid var(--primary-300); display: flex; gap: 1rem; justify-content: flex-end; }

        /* Consent Styles */
        .consent-section { margin-bottom: 2rem; }
        .consent-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
        .consent-item.essential { background: rgba(133, 96, 192, 0.1); }
        .consent-checkbox { margin-top: 2px; transform: scale(1.2); accent-color: var(--accent-purple); }

        /* Results Styles */
        .score-circle {
            width: 150px; height: 150px; border-radius: 50%;
            background: conic-gradient(var(--accent-purple) 0deg, var(--accent-purple) calc(var(--score) * 3.6deg), var(--primary-300) calc(var(--score) * 3.6deg));
            display: flex; align-items: center; justify-content: center; position: relative; margin: 0 auto 2rem;
        }
        .score-circle::before { content: ''; width: 120px; height: 120px; background: white; border-radius: 50%; position: absolute; }
        .score-text { z-index: 1; text-align: center; }
        .score-number { font-size: 2rem; font-weight: 700; color: var(--accent-purple); }

        /* Chart Container */
        .chart-container { position: relative; height: 300px; margin: 2rem 0; }

        /* Recommendations */
        .recommendation-grid { display: grid; gap: 1rem; margin-top: 2rem; }
        .recommendation-card { background: white; border-radius: 0.75rem; padding: 1.5rem; border-left: 4px solid var(--accent-purple); box-shadow: var(--shadow-sm); transition: transform 0.3s ease; }
        .recommendation-card:hover { transform: translateY(-5px); }
        .recommendation-priority { display: inline-block; padding: 0.25rem 0.75rem; background: var(--gradient-accent); color: white; border-radius: 1rem; font-size: 0.875rem; font-weight: 600; margin-bottom: 1rem; }

        /* Loading Spinner */
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: var(--accent-purple); animation: spin 1s ease-in-out infinite; margin: 0 auto; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Toast Notifications */
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 1rem 1.5rem; border-radius: 0.75rem; background: white; box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 0.75rem; z-index: 1000; transform: translateY(100px); opacity: 0; transition: all 0.3s ease; }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { border-left: 4px solid var(--success-500); }
        .toast.error { border-left: 4px solid var(--error-500); }

        /* Responsive Design */
        @media (max-width: 1100px) {
            .contenedor-tarjetas { flex-wrap: wrap; }
            .titulo-principal { font-size: 2.5rem; }
            .subtitulo { font-size: 1.1rem; }
        }

        @media (max-width: 768px) {
            .text-display { font-size: 2.5rem; }
            .text-h1 { font-size: 2rem; }
            .text-h2 { font-size: 1.75rem; }
            .section { padding: 2rem 0; }
            .scale-options { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.5rem; }
            .modal-content { margin: 0.5rem; max-height: 95vh; }
            
            /* Landing Responsive */
            .contenido-principal { padding: 1.5rem; }
            .titulo-principal { font-size: 2rem; }
            .subtitulo { font-size: 1rem; margin-bottom: 2rem; }
            .boton-principal { padding: 1rem 2rem; font-size: 1rem; }
            .tarjeta-landing { width: 100%; max-width: 320px; }
            .orbita { display: none; }
        }

        /* Animation Classes */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Category Progress */
        .category-list { display: grid; gap: 1rem; margin: 2rem 0; }
        .category-item { display: flex; align-items: center; padding: 1rem; background: white; border-radius: 0.75rem; border: 2px solid var(--primary-300); transition: all 0.3s ease; }
        .category-item.completed { border-color: var(--success-500); background: rgba(16, 185, 129, 0.1); }
        .category-item.current { border-color: var(--accent-purple); background: rgba(133, 96, 192, 0.1); }
        .category-icon {
            width: 40px; height: 40px; border-radius: 50%; background: var(--primary-500);
            color: white; display: flex; align-items: center; justify-content: center;
            margin-right: 1rem; font-size: 1.25rem;
        }
        .category-item.completed .category-icon { background: var(--success-500); }
        .category-item.current .category-icon { background: var(--accent-purple); }

        /* Policy Link */
        .policy-link { color: var(--accent-purple); text-decoration: underline; cursor: pointer; font-weight: 500; }
        .policy-link:hover { color: var(--accent-blue-dark); }

        /* Registration form adjustments */
        .compact-form { max-height: 70vh; overflow-y: auto; padding-right: 0.5rem; }
        .compact-form .form-group { margin-bottom: 0.8rem; }
        .compact-form .form-input,
        .compact-form .form-select { padding: 0.6rem 0.8rem; font-size: 0.9rem; }

        /* Tooltip always visible */
        .tooltip-container { background: var(--primary-900); color: white; padding: 1rem; border-radius: 0.75rem; margin: 1rem 0; }

        /* Impact and effort visualization */
        .impact-effort-indicator { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; }
        .indicator-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .impact-high { background-color: var(--success-500); }
        .impact-medium { background-color: var(--warning-500); }
        .impact-low { background-color: var(--error-500); }
        .effort-high { background-color: var(--error-500); }
        .effort-medium { background-color: var(--warning-500); }
        .effort-low { background-color: var(--success-500); }

        /* Next steps buttons adjustment */
        .next-steps-buttons { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem; }
    </style>
</head>
<body>
    <div id="toast" class="toast hidden">
        <span id="toast-message"></span>
    </div>

    <div id="loadingOverlay" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 300px; text-align: center;">
            <div class="modal-body">
                <div class="spinner"></div>
                <p class="text-body mt-4" id="loadingText">Guardando informaci√≥n...</p>
            </div>
        </div>
    </div>

    <section id="landing">
         <div class="contenedor-principal">
            <div class="fondo-dinamico">
                <div class="orbita orbita-1"><div class="punto-orbita punto-1"></div></div>
                <div class="orbita orbita-2"><div class="punto-orbita punto-2"></div><div class="punto-orbita punto-3"></div></div>
                <div class="linea-curva"></div>
                <div class="linea-curva linea-curva-2"></div>
            </div>

            <div class="contenido-principal">
                <img src="https://via.placeholder.com/280x70/FFFFFF/27325A?text=ForjaDigitalAE" alt="ForjaDigitalAE Logo" class="logo">
                <h1 class="titulo-principal">¬øQu√© tan digital es realmente tu PYME?</h1>
                <p class="subtitulo">Descubre tu nivel de madurez digital en 15 minutos y recibe un reporte profesional con tu roadmap de transformaci√≥n personalizado</p>
                <button class="boton-principal" onclick="showConsentModal()">Evaluar mi PYME Gratis</button>
            </div>

            <div class="contenedor-tarjetas">
                <div class="tarjeta-landing">
                    <span class="icono-tarjeta">üìä</span>
                    <h3 class="titulo-tarjeta">Diagn√≥stico Completo</h3>
                    <p class="texto-tarjeta">Evaluamos 10 dimensiones clave de la madurez de tu empresa</p>
                </div>
                <div class="tarjeta-landing">
                    <span class="icono-tarjeta">üéØ</span>
                    <h3 class="titulo-tarjeta">Recomendaciones Espec√≠ficas</h3>
                    <p class="texto-tarjeta">Recibe un plan de acci√≥n personalizado con prioridades claras para tu sector</p>
                </div>
                <div class="tarjeta-landing">
                    <span class="icono-tarjeta">üìà</span>
                    <h3 class="titulo-tarjeta">Comparaci√≥n Sectorial</h3>
                    <p class="texto-tarjeta">Descubre c√≥mo te comparas con otras PYMEs de tu sector y regi√≥n</p>
                </div>
            </div>
        </div>
    </section>

    <div id="consentModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--accent-purple);">üîí</div>
                <h2 class="text-h2">Tus Datos Est√°n Seguros Con Nosotros</h2>
                <p class="text-body" style="opacity: 0.8; margin-top: 1rem;">
                    En ForjaDigitalAE respetamos la privacidad de tu empresa. Para ofrecerte la mejor evaluaci√≥n de madurez, necesitamos tu autorizaci√≥n para:
                </p>
            </div>
            <div class="modal-body">
                <div class="consent-section">
                    <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">‚úÖ ESENCIAL PARA EL SERVICIO:</h3>
                    <div class="consent-item essential">
                        <input type="checkbox" class="consent-checkbox" checked disabled>
                        <div>
                            <strong>Almacenar datos de tu empresa para generar la evaluaci√≥n</strong>
                            <p style="font-size: 0.875rem; opacity: 0.7; margin-top: 0.25rem;">Se elimina autom√°ticamente tras 90 d√≠as de inactividad</p>
                        </div>
                    </div>
                    <div class="consent-item essential">
                        <input type="checkbox" class="consent-checkbox" checked disabled>
                        <div>
                            <strong>Procesar tus respuestas para crear tu reporte personalizado</strong>
                        </div>
                    </div>
                </div>

                <div class="consent-section">
                    <h3 style="color: var(--accent-orange); margin-bottom: 1rem;">üéØ MEJORA TU EXPERIENCIA (Opcional):</h3>
                    <div class="consent-item">
                        <input type="checkbox" class="consent-checkbox" id="consentCommunications">
                        <div>
                            <strong>Recibir consejos personalizados sobre transformaci√≥n digital</strong>
                        </div>
                    </div>
                    <div class="consent-item">
                        <input type="checkbox" class="consent-checkbox" id="consentBenchmarking">
                        <div>
                            <strong>Participar en benchmarking an√≥nimo sectorial</strong>
                        </div>
                    </div>
                </div>

                <div style="background: var(--primary-50); padding: 1rem; border-radius: 0.5rem; font-size: 0.875rem;">
                    <strong style="color: var(--accent-purple);">üí° TU MANTIENES EL CONTROL:</strong>
                    <ul style="margin-top: 0.5rem; padding-left: 1rem;">
                        <li>Puedes retirar tu consentimiento en cualquier momento</li>
                        <li>Tus datos nunca se venden a terceros</li>
                        <li>Eliminamos tus datos cuando lo solicites</li>
                    </ul>
                    <p class="mt-2">Puedes consultar nuestra <span class="policy-link" onclick="showPrivacyPolicy()">Pol√≠tica de Privacidad completa</span> para m√°s informaci√≥n.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="hideConsentModal()">No acepto</button>
                <button class="btn btn-primary" onclick="acceptConsent()">Acepto y Contin√∫o</button>
            </div>
        </div>
    </div>

    <div id="privacyPolicyModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-h2">Pol√≠tica de Privacidad y Gesti√≥n de Datos</h2>
            </div>
            <div class="modal-body">
                <div style="max-height: 60vh; overflow-y: auto;">
                    <p> <h3>Pol√≠tica de Privacidad</h3>
                        1. Informaci√≥n que recopilamos
                        En ForjaDigitalAE recopilamos informaci√≥n que usted nos proporciona directamente cuando:

                        Completa formularios de contacto o evaluaciones
                        Se suscribe a nuestros servicios
                        Participa en evaluaciones de madurez empresarial
                        Se comunica con nosotros por email o WhatsApp
                        2. Uso de la informaci√≥n
                        Utilizamos su informaci√≥n para:

                        Proporcionar nuestros servicios de consultor√≠a
                        Generar reportes personalizados de evaluaci√≥n
                        Comunicarnos sobre nuestros servicios
                        Mejorar nuestros servicios y experiencia del usuario
                        3. Protecci√≥n de datos
                        Implementamos medidas de seguridad t√©cnicas y organizacionales para proteger su informaci√≥n personal contra acceso no autorizado, alteraci√≥n, divulgaci√≥n o destrucci√≥n.

                        4. Sus derechos
                        Usted tiene derecho a acceder, rectificar, actualizar o solicitar la eliminaci√≥n de su informaci√≥n personal contact√°ndonos en forjadigitalae@gmail.com</p>
                    <p><h3>Pol√≠tica de Gesti√≥n de Datos</h3>
                        Recopilaci√≥n de Datos
                        ForjaDigitalAE recopila y procesa datos personales √∫nicamente para fines leg√≠timos relacionados con nuestros servicios de consultor√≠a empresarial.

                        Tipos de datos que procesamos:
                        Datos de identificaci√≥n: Nombre, email, tel√©fono, empresa
                        Datos empresariales: Informaci√≥n sobre su empresa para evaluaciones
                        Datos de navegaci√≥n: Cookies t√©cnicas para mejorar la experiencia
                        Base legal para el procesamiento:
                        Consentimiento expl√≠cito para evaluaciones y comunicaciones
                        Inter√©s leg√≠timo para mejorar nuestros servicios
                        Cumplimiento contractual para prestaci√≥n de servicios
                        Retenci√≥n de datos:
                        Conservamos sus datos personales solo durante el tiempo necesario para cumplir con los fines para los cuales fueron recopilados, o seg√∫n lo requiera la ley colombiana.

                        Transferencia de datos:
                        No vendemos, alquilamos ni compartimos su informaci√≥n personal con terceros, excepto cuando sea necesario para proporcionar nuestros servicios o cuando lo requiera la ley.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hidePrivacyPolicy()">Entendido</button>
            </div>
        </div>
    </div>

    <section id="registration" class="section hidden">
        <div class="container">
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <div class="card-body">
                    <div class="text-center mb-6">
                        <h2 class="text-h2 mb-4">Cu√©ntanos sobre tu empresa</h2>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 33%;"></div>
                        </div>
                        <p class="text-body" style="opacity: 0.7;">Paso 1 de 3</p>
                    </div>

                    <form id="registrationForm" class="compact-form">
                        <div class="form-group">
                            <label class="form-label">Nombre de la empresa *</label>
                            <input type="text" class="form-input" id="companyName" placeholder="Ej: TechStart SAS" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Sector Econ√≥mico *</label>
                            <select class="form-select" id="companySector" required>
                                <option value="">Selecciona tu sector</option>
                                <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                                <option value="Retail/Comercio">Retail/Comercio</option>
                                <option value="Manufactura">Manufactura</option>
                                <option value="Servicios">Servicios</option>
                                <option value="Salud">Salud</option>
                                <option value="Educaci√≥n">Educaci√≥n</option>
                                <option value="Turismo">Turismo</option>
                                <option value="Agricultura">Agricultura</option>
                                <option value="Construcci√≥n">Construcci√≥n</option>
                                <option value="Transporte">Transporte</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Tama√±o de empresa *</label>
                                <select class="form-select" id="companySize" required>
                                    <option value="">Selecciona</option>
                                    <option value="Micro">Micro (1-10 empleados)</option>
                                    <option value="Peque√±a">Peque√±a (11-50 empleados)</option>
                                    <option value="Mediana">Mediana (51-200 empleados)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">A√±os en operaci√≥n *</label>
                                <input type="number" class="form-input" id="companyYears" min="0" max="100" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ubicaci√≥n *</label>
                            <input type="text" class="form-input" id="companyLocation" placeholder="Ciudad, Departamento" required>
                        </div>
                        <h3 class="text-h3 mb-4 mt-8">Datos de Contacto</h3>
                        <div class="form-group">
                            <label class="form-label">Nombre del contacto *</label>
                            <input type="text" class="form-input" id="contactName" placeholder="Tu nombre completo" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Cargo *</label>
                                <input type="text" class="form-input" id="contactRole" placeholder="Ej: CEO, Gerente" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-input" id="contactEmail" placeholder="correo@empresa.com" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tel√©fono *</label>
                            <input type="tel" class="form-input" id="contactPhone" placeholder="+57 300 123 4567" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sitio Web (Opcional)</label>
                            <input type="url" class="form-input" id="companyWebsite" placeholder="https://www.tuempresa.com">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 2rem;">
                            Comenzar Evaluaci√≥n ‚Üí
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <section id="evaluation" class="section hidden">
        <div class="container">
            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem; max-width: 1200px; margin: 0 auto;">
                <div class="card" style="height: fit-content; position: sticky; top: 2rem;">
                    <div class="card-body">
                        <div class="text-center mb-6">
                            <div class="score-circle" style="width: 120px; height: 120px; --score: 0;" id="overallProgress">
                                <div class="score-text">
                                    <div class="score-number" style="font-size: 1.5rem;" id="progressPercentage">0%</div>
                                    <div style="font-size: 0.75rem; opacity: 0.7;">Completado</div>
                                </div>
                            </div>
                            <h3 class="text-h3">Tu Progreso</h3>
                            <p class="text-body" style="opacity: 0.7;" id="progressText">0 de 10 categor√≠as</p>
                        </div>
                        <div class="category-list" id="categoryProgress"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div id="categoryHeader" class="mb-6">
                            <div style="display: inline-block; background: rgba(133, 96, 192, 0.1); color: var(--accent-purple); padding: 0.5rem 1rem; border-radius: 2rem; font-weight: 600; margin-bottom: 1rem;" id="categoryBadge"></div>
                            <h1 class="text-h1 mb-4" id="categoryTitle"></h1>
                            <p class="text-body-lg" style="opacity: 0.8;" id="categoryDescription"></p>
                            <div class="progress-bar mt-4">
                                <div class="progress-fill" id="categoryProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div id="questionCard" class="fade-in">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <div style="background: var(--primary-50); color: var(--primary-700); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 600; display: inline-block;" id="questionNumber"></div>
                                </div>
                            </div>
                            <h3 class="text-h3 mb-6" id="questionText" style="line-height: 1.5;"></h3>
                            <div id="tooltipBox" class="tooltip-container">
                                <p id="tooltipText" style="margin: 0;"></p>
                            </div>
                            <div class="scale-options" id="scaleOptions"></div>
                            <div id="selectedFeedback" class="hidden text-center mt-4">
                                <div id="feedbackMessage" style="display: inline-flex; align-items: center; padding: 0.75rem 1.5rem; border-radius: 2rem; font-weight: 600;"></div>
                            </div>
                            <div class="flex justify-between mt-8">
                                <button id="prevBtn" class="btn btn-outline" onclick="previousQuestion()" disabled>‚Üê Anterior</button>
                                <button id="nextBtn" class="btn btn-primary" onclick="nextQuestion()" disabled>Siguiente ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="results" class="section hidden">
        <div class="container">
            <div class="text-center mb-8">
                <h1 class="text-h1 mb-4">üéâ ¬°Felicitaciones! Tu Evaluaci√≥n Est√° Completa</h1>
                <p class="text-body-lg" style="opacity: 0.8;">Aqu√≠ est√°n los resultados de tu nivel de madurez empresarial</p>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; max-width: 1000px; margin: 0 auto;">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="score-circle" style="--score: 0;" id="finalScore">
                            <div class="score-text">
                                <div class="score-number" id="finalScoreNumber">0</div>
                                <div style="font-size: 0.875rem; opacity: 0.7;">Puntuaci√≥n</div>
                            </div>
                        </div>
                        <div id="maturityBadge" style="display: inline-block; padding: 0.75rem 1.5rem; background: var(--gradient-accent); color: white; border-radius: 2rem; font-weight: 600; margin-bottom: 1rem;"></div>
                        <p id="maturityDescription" style="opacity: 0.8;"></p>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 2rem;" onclick="downloadPDF()">üìÑ Descargar Reporte PDF</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h3 class="text-h3 mb-4">Tu Perfil de Madurez</h3>
                        <div class="chart-container"><canvas id="radarChart"></canvas></div>
                    </div>
                </div>
            </div>
            <div class="card mt-8">
                <div class="card-body">
                    <h2 class="text-h2 mb-6">üìä Resultados Detallados por Eje</h2>
                    <div id="detailedResults" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;"></div>
                </div>
            </div>
            <div class="card mt-8">
                <div class="card-body">
                    <h2 class="text-h2 mb-6">üéØ Tus Recomendaciones Personalizadas</h2>
                    <div class="recommendation-grid" id="recommendations"></div>
                </div>
            </div>
            <div class="card mt-8" style="background: var(--gradient-primary); color: white;">
                <div class="card-body text-center">
                    <h2 class="text-h2 mb-4">üöÄ ¬øListo para transformar tu PYME?</h2>
                    <p class="text-body-lg mb-6">En ForjaDigitalAE te ayudamos a implementar estas recomendaciones con un plan personalizado</p>
                    <div class="next-steps-buttons">
                        <button class="btn" style="background: white; color: var(--primary-900);">üìû Agendar Consulta Gratuita</button>
                        <button class="btn btn-outline" style="border-color: white; color: white;">üìß Recibir M√°s Informaci√≥n</button>
                        <button class="btn btn-secondary" onclick="resetApp()">‚Üê Volver al Inicio</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Application State
        let appState = {
            currentSection: 'landing',
            companyData: {},
            evaluationData: { currentCategory: 0, currentQuestion: 0, answers: {}, categoryScores: {} },
            consent: { essential: true, communications: false, benchmarking: false }
        };

        // Google Sheets Configuration (Opcional)
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzIuXI31i4xR4OTV8QJ6r0juEwTIyj5-06PYzOGel0dFcMZK7U5BHsMuVZ0CSZESmAMOw/exec'; // Reemplazar con tu URL de Google Apps Script

        // Ejes de Evaluaci√≥n Hol√≠sticos
        const categories = [
            {
                id: 'vision_estrategia',
                name: 'Visi√≥n y Estrategia',
                icon: 'üéØ',
                weight: 0.10,
                description: 'Se eval√∫a si la empresa tiene una visi√≥n clara a largo plazo y una estrategia bien definida para alcanzarla, que est√© comunicada y comprendida por todos los miembros del equipo.',
                questions: [
                    { id: 've_01', text: '¬øLa empresa tiene una visi√≥n a largo plazo, formalmente documentada y comunicada a todo el equipo?', tooltip: 'La visi√≥n debe ser un documento escrito, conocido y entendido por todos, que gu√≠e las decisiones y acciones diarias.', weight: 1.2 },
                    { id: 've_02', text: '¬øExiste un plan estrat√©gico claro que detalle los objetivos, metas y acciones para los pr√≥ximos 3-5 a√±os?', tooltip: 'El plan debe incluir indicadores clave de rendimiento (KPIs) para medir el progreso y ser revisado peri√≥dicamente.', weight: 1.2 },
                    { id: 've_03', text: '¬øLa estrategia de la empresa considera activamente las tendencias del mercado y el entorno competitivo?', tooltip: 'Se deben realizar an√°lisis peri√≥dicos del mercado y la competencia para asegurar que la estrategia siga siendo relevante y efectiva.', weight: 1.0 },
                    { id: 've_04', text: '¬øLos objetivos de los departamentos y de los empleados est√°n claramente alineados con la estrategia general de la empresa?', tooltip: 'La estrategia debe desglosarse en objetivos espec√≠ficos para cada √°rea, asegurando que todos trabajen hacia la misma direcci√≥n.', weight: 1.1 },
                    { id: 've_05', text: '¬øSe asignan recursos (financieros, humanos, tecnol√≥gicos) de manera coherente con las prioridades estrat√©gicas?', tooltip: 'El presupuesto y la asignaci√≥n de talento deben reflejar las √°reas que la estrategia ha definido como prioritarias.', weight: 1.1 }
                ]
            },
            {
                id: 'gobierno_empresarial',
                name: 'Gobierno Empresarial',
                icon: 'üèõÔ∏è',
                weight: 0.10,
                description: 'Analiza la solidez de las estructuras de toma de decisiones, las pol√≠ticas internas y los procesos de control que aseguran el cumplimiento de los objetivos y la rendici√≥n de cuentas.',
                questions: [
                    { id: 'ge_01', text: '¬øExisten roles y responsabilidades claramente definidos para los l√≠deres y directivos de la empresa?', tooltip: 'Debe haber un organigrama claro y descripciones de cargo que eviten la ambig√ºedad en las responsabilidades de liderazgo.', weight: 1.2 },
                    { id: 'ge_02', text: '¬øLa empresa cuenta con pol√≠ticas y procedimientos internos documentados para las √°reas clave (finanzas, RRHH, operaciones)?', tooltip: 'Las pol√≠ticas escritas garantizan la consistencia, reducen riesgos y facilitan la incorporaci√≥n de nuevo personal.', weight: 1.1 },
                    { id: 'ge_03', text: '¬øSe realizan reuniones de seguimiento peri√≥dicas para revisar el desempe√±o y tomar decisiones informadas?', tooltip: 'Deben existir comit√©s o reuniones estructuradas (semanales, mensuales) donde se analicen datos y se tomen decisiones clave.', weight: 1.0 },
                    { id: 'ge_04', text: '¬øExiste un proceso formal para la gesti√≥n de riesgos que identifique, eval√∫e y mitigue los riesgos potenciales del negocio?', tooltip: 'La gesti√≥n de riesgos no debe ser reactiva. Se necesita un enfoque proactivo para anticipar y controlar las amenazas.', weight: 1.2 },
                    { id: 'ge_05', text: '¬øHay mecanismos de control interno y auditor√≠a para asegurar el cumplimiento de las pol√≠ticas y la normativa vigente?', tooltip: 'Se deben realizar revisiones o auditor√≠as peri√≥dicas (internas o externas) para verificar que los procesos se sigan correctamente.', weight: 1.0 }
                ]
            },
            {
                id: 'procesos_operaciones',
                name: 'Procesos y Operaciones',
                icon: '‚öôÔ∏è',
                weight: 0.10,
                description: 'Mide la eficiencia y la estandarizaci√≥n de los flujos de trabajo clave, identificando oportunidades para optimizar y automatizar tareas.',
                questions: [
                    { id: 'po_01', text: '¬øLos procesos clave del negocio (ventas, producci√≥n, entrega) est√°n documentados y estandarizados?', tooltip: 'Tener los procesos mapeados y estandarizados permite una operaci√≥n consistente, reduce errores y facilita la mejora continua.', weight: 1.2 },
                    { id: 'po_02', text: '¬øSe utilizan herramientas tecnol√≥gicas para automatizar tareas repetitivas y manuales en las operaciones diarias?', tooltip: 'La automatizaci√≥n libera tiempo del personal para tareas de mayor valor y aumenta la eficiencia general del negocio.', weight: 1.1 },
                    { id: 'po_03', text: '¬øSe miden y monitorean regularmente los indicadores de rendimiento de los procesos (ej. tiempo de ciclo, costos, calidad)?', tooltip: 'Lo que no se mide no se puede mejorar. Es fundamental tener m√©tricas para evaluar la eficiencia de los procesos.', weight: 1.1 },
                    { id: 'po_04', text: '¬øExiste una cultura de mejora continua donde se buscan activamente formas de optimizar los flujos de trabajo?', tooltip: 'Los equipos deben estar empoderados para identificar cuellos de botella y proponer mejoras en sus procesos.', weight: 1.0 },
                    { id: 'po_05', text: '¬øLos diferentes sistemas y aplicaciones utilizados en la empresa est√°n integrados para permitir un flujo de informaci√≥n sin interrupciones?', tooltip: 'La falta de integraci√≥n crea silos de informaci√≥n y duplicaci√≥n de trabajo. Los sistemas deben "hablar" entre s√≠.', weight: 1.2 }
                ]
            },
            {
                id: 'talento_cultura',
                name: 'Gesti√≥n de Talento y Cultura',
                icon: 'üë•',
                weight: 0.10,
                description: 'Eval√∫a si la cultura de la empresa fomenta la colaboraci√≥n, la innovaci√≥n y el desarrollo continuo. Tambi√©n se examinan las capacidades del personal para afrontar los desaf√≠os futuros con un enfoque digital.',
                questions: [
                    { id: 'tc_01', text: '¬øLa empresa tiene un proceso estructurado para atraer, seleccionar y retener al talento adecuado?', tooltip: 'Esto incluye desde la publicaci√≥n de vacantes hasta los planes de carrera y beneficios para mantener motivados a los empleados.', weight: 1.1 },
                    { id: 'tc_02', text: '¬øSe invierte en programas de capacitaci√≥n y desarrollo para mejorar las habilidades del personal, especialmente las digitales?', tooltip: 'El desarrollo de competencias es clave para la adaptabilidad. La empresa debe ofrecer formaci√≥n continua a sus equipos.', weight: 1.2 },
                    { id: 'tc_03', text: '¬øLa cultura organizacional promueve la colaboraci√≥n entre equipos, la comunicaci√≥n abierta y el feedback constructivo?', tooltip: 'Una cultura saludable fomenta el trabajo en equipo y un ambiente donde las ideas fluyen libremente sin miedo a represalias.', weight: 1.0 },
                    { id: 'tc_04', text: '¬øSe realizan evaluaciones de desempe√±o peri√≥dicas que est√°n alineadas con los objetivos estrat√©gicos de la empresa?', tooltip: 'Las evaluaciones deben ser una herramienta para el desarrollo del empleado y para asegurar la alineaci√≥n con las metas del negocio.', weight: 1.0 },
                    { id: 'tc_05', text: '¬øEl liderazgo de la empresa inspira y modela los valores y comportamientos deseados en la cultura organizacional?', tooltip: 'Los l√≠deres son el principal motor de la cultura. Su ejemplo es fundamental para que los valores se vivan en el d√≠a a d√≠a.', weight: 1.3 }
                ]
            },
            {
                id: 'innovacion_agilidad',
                name: 'Innovaci√≥n y Agilidad',
                icon: 'üí°',
                weight: 0.10,
                description: 'Analiza la capacidad de la empresa para adaptarse r√°pidamente a los cambios del mercado, generar nuevas ideas y transformar los desaf√≠os en oportunidades mediante la adopci√≥n de tecnolog√≠as emergentes.',
                questions: [
                    { id: 'ia_01', text: '¬øLa empresa dedica tiempo y recursos para explorar nuevas ideas, productos o modelos de negocio?', tooltip: 'La innovaci√≥n requiere una inversi√≥n intencional. Puede ser a trav√©s de un equipo dedicado, tiempo asignado o un presupuesto espec√≠fico.', weight: 1.2 },
                    { id: 'ia_02', text: '¬øSe fomenta la experimentaci√≥n y se aceptan los fracasos como una parte del proceso de aprendizaje?', tooltip: 'Una cultura que castiga el error inhibe la innovaci√≥n. Se deben celebrar los aprendizajes, incluso de los experimentos fallidos.', weight: 1.1 },
                    { id: 'ia_03', text: '¬øLa empresa es capaz de tomar decisiones y ajustar su rumbo r√°pidamente en respuesta a cambios en el mercado?', tooltip: 'La agilidad se refleja en la capacidad de reaccionar con rapidez, evitando la burocracia excesiva en la toma de decisiones.', weight: 1.1 },
                    { id: 'ia_04', text: '¬øSe monitorean activamente las tecnolog√≠as emergentes (IA, IoT, etc.) y se eval√∫a su aplicabilidad para el negocio?', tooltip: 'La empresa debe tener un "radar" tecnol√≥gico para identificar herramientas que puedan generar una ventaja competitiva.', weight: 1.0 },
                    { id: 'ia_05', text: '¬øSe colabora con clientes, proveedores o startups para co-crear soluciones innovadoras?', tooltip: 'La innovaci√≥n no tiene por qu√© ser interna. Las alianzas estrat√©gicas pueden acelerar el desarrollo de nuevas ideas.', weight: 1.0 }
                ]
            },
            {
                id: 'estrategia_tecnologica',
                name: 'Estrategia Tecnol√≥gica',
                icon: 'üíª',
                weight: 0.10,
                description: 'Se eval√∫a la tecnol√≥gica actual para determinar si est√° alineada con los objetivos de la empresa, es escalable y permite la integraci√≥n de nuevas herramientas, garantizando la seguridad de los datos sensibles y la ciberseguridad.',
                questions: [
                    { id: 'et_01', text: '¬øLa infraestructura tecnol√≥gica actual (hardware, software, redes) soporta adecuadamente las necesidades del negocio?', tooltip: 'La tecnolog√≠a debe ser un habilitador, no un obst√°culo. Debe ser confiable, r√°pida y adecuada para las operaciones.', weight: 1.1 },
                    { id: 'et_02', text: '¬øExiste un plan o "roadmap" tecnol√≥gico que gu√≠e las futuras inversiones y actualizaciones de tecnolog√≠a?', tooltip: 'Las decisiones tecnol√≥gicas no deben ser improvisadas. Un plan a 2-3 a√±os asegura que las inversiones est√©n alineadas con la estrategia.', weight: 1.2 },
                    { id: 'et_03', text: '¬øLa arquitectura tecnol√≥gica es escalable para soportar el crecimiento futuro de la empresa?', tooltip: 'Los sistemas deben poder crecer en capacidad (m√°s usuarios, m√°s datos, m√°s transacciones) sin necesidad de ser reemplazados por completo.', weight: 1.1 },
                    { id: 'et_04', text: '¬øSe cuenta con pol√≠ticas y herramientas robustas de ciberseguridad para proteger los datos y sistemas de la empresa?', tooltip: 'Esto incluye antivirus, firewalls, copias de seguridad, gesti√≥n de contrase√±as y capacitaci√≥n a empleados sobre seguridad.', weight: 1.3 },
                    { id: 'et_05', text: '¬øSe eval√∫a el retorno de la inversi√≥n (ROI) de las iniciativas tecnol√≥gicas para asegurar que generen valor real?', tooltip: 'La tecnolog√≠a es una inversi√≥n. Se debe medir su impacto en la eficiencia, los ingresos o la satisfacci√≥n del cliente.', weight: 1.0 }
                ]
            },
            {
                id: 'inteligencia_negocio',
                name: 'Inteligencia de Negocio y Datos',
                icon: 'üìä',
                weight: 0.10,
                description: 'Examina c√≥mo la empresa recopila, procesa y utiliza sus datos para tomar decisiones estrat√©gicas basadas en evidencia, en lugar de solo en la intuici√≥n.',
                questions: [
                    { id: 'in_01', text: '¬øLa empresa recopila sistem√°ticamente datos de sus operaciones, clientes y mercado?', tooltip: 'Se deben tener procesos definidos para capturar datos de fuentes clave (CRM, ERP, web, redes sociales) de manera consistente.', weight: 1.1 },
                    { id: 'in_02', text: '¬øLos datos se almacenan de forma centralizada y organizada, garantizando su calidad y consistencia?', tooltip: 'Tener una "√∫nica fuente de la verdad" es crucial para evitar informes contradictorios y decisiones basadas en datos err√≥neos.', weight: 1.2 },
                    { id: 'in_03', text: '¬øSe utilizan herramientas de visualizaci√≥n de datos (dashboards, reportes) para monitorear los indicadores clave del negocio?', tooltip: 'Los l√≠deres y equipos deben tener acceso f√°cil a paneles visuales que muestren el rendimiento del negocio en tiempo real.', weight: 1.1 },
                    { id: 'in_04', text: '¬øLas decisiones estrat√©gicas y t√°cticas se respaldan con an√°lisis de datos en lugar de basarse √∫nicamente en la intuici√≥n?', tooltip: 'La cultura de la empresa debe promover que se presenten datos y an√°lisis para justificar decisiones importantes.', weight: 1.3 },
                    { id: 'in_05', text: '¬øEl personal tiene las habilidades b√°sicas para interpretar datos y utilizarlos en sus roles diarios?', tooltip: 'No es solo para analistas. Todos en la empresa deben tener una "alfabetizaci√≥n de datos" b√°sica para entender los gr√°ficos y m√©tricas.', weight: 1.0 }
                ]
            },
            {
                id: 'experiencia_cliente',
                name: 'Experiencia del Cliente (CX)',
                icon: 'üß°',
                weight: 0.10,
                description: 'Se mide el nivel de satisfacci√≥n del cliente y se analizan los puntos de contacto para identificar oportunidades de mejorar su experiencia y fidelizaci√≥n.',
                questions: [
                    { id: 'cx_01', text: '¬øSe mide de forma sistem√°tica la satisfacci√≥n del cliente (ej. con encuestas como NPS, CSAT)?', tooltip: 'Es fundamental tener un m√©todo constante para escuchar la "voz del cliente" y medir su nivel de satisfacci√≥n con el servicio.', weight: 1.2 },
                    { id: 'cx_02', text: '¬øSe han mapeado los "viajes del cliente" (customer journeys) para entender todos sus puntos de contacto con la empresa?', tooltip: 'Mapear el viaje del cliente ayuda a identificar momentos de fricci√≥n y oportunidades de mejora en cada interacci√≥n.', weight: 1.1 },
                    { id: 'cx_03', text: '¬øSe utiliza la retroalimentaci√≥n de los clientes para implementar mejoras concretas en productos, servicios o procesos?', tooltip: 'Escuchar al cliente no es suficiente. Se debe tener un proceso para actuar sobre su feedback y comunicar las mejoras realizadas.', weight: 1.3 },
                    { id: 'cx_04', text: '¬øLa experiencia del cliente es consistente y de alta calidad a trav√©s de todos los canales (f√≠sicos y digitales)?', tooltip: 'El cliente debe recibir el mismo nivel de servicio ya sea en la tienda, en la web, por tel√©fono o en redes sociales.', weight: 1.0 },
                    { id: 'cx_05', text: '¬øSe personaliza la comunicaci√≥n y la oferta para los diferentes segmentos de clientes?', tooltip: 'Utilizar los datos del cliente para ofrecer una experiencia m√°s relevante y personalizada aumenta la lealtad y la conversi√≥n.', weight: 1.0 }
                ]
            },
            {
                id: 'sostenibilidad_responsabilidad',
                name: 'Sostenibilidad y Responsabilidad',
                icon: 'üåç',
                weight: 0.10,
                description: 'Eval√∫a el compromiso de la empresa con pr√°cticas que generen un impacto positivo en la sociedad y el medio ambiente, as√≠ como el seguimiento de m√©tricas de responsabilidad social corporativa (RSC).',
                questions: [
                    { id: 'sr_01', text: '¬øLa empresa tiene una pol√≠tica de sostenibilidad o responsabilidad social corporativa (RSC) definida?', tooltip: 'Debe haber un compromiso formal que gu√≠e las acciones de la empresa en materia social y ambiental.', weight: 1.1 },
                    { id: 'sr_02', text: '¬øSe han implementado pr√°cticas para reducir el impacto ambiental de las operaciones (ej. reciclaje, ahorro de energ√≠a)?', tooltip: 'Se deben tomar acciones concretas para minimizar la huella ecol√≥gica de la empresa, por peque√±as que sean.', weight: 1.0 },
                    { id: 'sr_03', text: '¬øLa empresa participa en iniciativas sociales o apoya a la comunidad local de alguna manera?', tooltip: 'Esto puede incluir voluntariado, donaciones, apoyo a fundaciones locales o programas de desarrollo comunitario.', weight: 1.0 },
                    { id: 'sr_04', text: '¬øSe consideran criterios √©ticos y de sostenibilidad al seleccionar proveedores y socios comerciales?', tooltip: 'La responsabilidad se extiende a toda la cadena de suministro. Se debe preferir trabajar con socios que compartan los mismos valores.', weight: 1.2 },
                    { id: 'sr_05', text: '¬øSe comunican de forma transparente las acciones y el desempe√±o de la empresa en materia de sostenibilidad?', tooltip: 'La transparencia genera confianza. Se deben publicar informes o comunicados sobre los avances en los objetivos de RSC.', weight: 1.1 }
                ]
            },
            {
                id: 'finanzas_rentabilidad',
                name: 'Finanzas y Rentabilidad',
                icon: 'üí∞',
                weight: 0.10,
                description: 'Analiza la gesti√≥n financiera de la empresa, incluyendo el control de costos, el seguimiento del flujo de caja y la capacidad para generar rentabilidad a largo plazo.',
                questions: [
                    { id: 'fr_01', text: '¬øSe elabora un presupuesto anual detallado y se realiza un seguimiento peri√≥dico de su ejecuci√≥n?', tooltip: 'El presupuesto es una herramienta de control fundamental. Se debe comparar lo presupuestado con lo real para tomar correctivos a tiempo.', weight: 1.2 },
                    { id: 'fr_02', text: '¬øSe monitorea de cerca el flujo de caja (cash flow) para asegurar la liquidez y la salud financiera de la empresa?', tooltip: 'El flujo de caja es el "ox√≠geno" del negocio. Su gesti√≥n proactiva es vital para la supervivencia y el crecimiento.', weight: 1.3 },
                    { id: 'fr_03', text: '¬øSe analizan regularmente los estados financieros (balance, estado de resultados) para entender la rentabilidad del negocio?', tooltip: 'La direcci√≥n debe entender y utilizar la informaci√≥n financiera para tomar decisiones estrat√©gicas sobre precios, costos e inversiones.', weight: 1.1 },
                    { id: 'fr_04', text: '¬øExisten pol√≠ticas claras para la gesti√≥n de costos y se buscan continuamente oportunidades de eficiencia?', tooltip: 'El control de costos debe ser una disciplina constante en toda la organizaci√≥n, no solo una reacci√≥n en tiempos de crisis.', weight: 1.0 },
                    { id: 'fr_05', text: '¬øLa empresa tiene un plan financiero a largo plazo que respalde su estrategia de crecimiento?', tooltip: 'El plan financiero proyecta las necesidades de capital y la rentabilidad esperada para asegurar que el crecimiento sea sostenible.', weight: 1.1 }
                ]
            }
        ];

        const scaleLabels = [
            'Muy Bajo / No aplica', 'Bajo / Iniciando', 'Medio / En desarrollo',
            'Alto / Bien implementado', 'Muy Alto / Excelente'
        ];

        const scaleColors = ['#AA2F0C', '#EC8E48', '#EE8028', '#4CCED5', '#10b981'];

        // UI Functions
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
            const currentSection = document.getElementById(sectionId);
            if(currentSection) currentSection.classList.remove('hidden');
            
            appState.currentSection = sectionId;
            window.scrollTo(0, 0);

            if (sectionId !== 'landing') {
                document.body.style.background = 'var(--primary-50)';
                document.body.classList.add('section-view');
            } else {
                document.body.style.background = 'var(--azul-marino)';
                document.body.classList.remove('section-view');
            }
        }
        
        function resetApp() {
            localStorage.removeItem('pymeEvaluationState');
            location.reload();
        }

        function showConsentModal() { document.getElementById('consentModal').classList.remove('hidden'); }
        function hideConsentModal() { document.getElementById('consentModal').classList.add('hidden'); }
        function showPrivacyPolicy() { document.getElementById('privacyPolicyModal').classList.remove('hidden'); }
        function hidePrivacyPolicy() { document.getElementById('privacyPolicyModal').classList.add('hidden'); }

        function acceptConsent() {
            appState.consent.communications = document.getElementById('consentCommunications').checked;
            appState.consent.benchmarking = document.getElementById('consentBenchmarking').checked;
            hideConsentModal();
            showSection('registration');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => { toast.className = 'toast hidden'; }, 3000);
        }

        function showLoading(message = 'Guardando informaci√≥n...') {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Generar ID √∫nico para la evaluaci√≥n
            const evaluationId = generateUUID();
            
            appState.companyData = {
                id: evaluationId,
                timestamp: new Date().toISOString(),
                name: document.getElementById('companyName').value,
                sector: document.getElementById('companySector').value,
                size: document.getElementById('companySize').value,
                years: parseInt(document.getElementById('companyYears').value),
                location: document.getElementById('companyLocation').value,
                contact: {
                    name: document.getElementById('contactName').value,
                    role: document.getElementById('contactRole').value,
                    email: document.getElementById('contactEmail').value,
                    phone: document.getElementById('contactPhone').value
                },
                website: document.getElementById('companyWebsite').value,
                consent: appState.consent
            };
            
            try {
                showLoading('Guardando informaci√≥n de tu empresa...');
                
                // Enviar a Google Sheets con el nuevo formato
                await submitEvaluationToGoogleSheets(appState.companyData);
                
                hideLoading();
                initializeEvaluation();
                showSection('evaluation');
            } catch (error) {
                hideLoading();
                showToast('Error al guardar la informaci√≥n. Por favor, intenta nuevamente.', 'error');
                console.error('Error saving company data:', error);
            }
        });

        // NUEVA FUNCI√ìN: Enviar datos de evaluaci√≥n a Google Sheets
        async function submitEvaluationToGoogleSheets(companyData) {
            // ‚ö†Ô∏è IMPORTANTE: REEMPLAZA ESTA URL CON TU URL DE GOOGLE APPS SCRIPT
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxV6oR9z1Px-YnlbZXR-rJ04Kz-6g7A6DLMDGwg9E460EGuBnS2X5TEcScXtXN0zCrVqA/exec';
            
            const dataToSend = {
                source: 'evaluation',  // Identificador para el formulario de evaluaci√≥n
                evaluationId: companyData.id,
                companyName: companyData.name,
                companySector: companyData.sector,
                companySize: companyData.size,
                companyYears: companyData.years,
                companyLocation: companyData.location,
                companyWebsite: companyData.website || '',
                contactName: companyData.contact.name,
                contactRole: companyData.contact.role,
                contactEmail: companyData.contact.email,
                contactPhone: companyData.contact.phone,
                consent: companyData.consent
            };
            
            return fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dataToSend)
            })
            .then(() => {
                console.log('Datos de evaluaci√≥n enviados exitosamente');
            })
            .catch(error => {
                console.error('Error al enviar datos:', error);
                throw error; // Re-lanzar el error para que lo capture el try-catch principal
            });
        }

       async function saveToGoogleSheets(data, sheetName) {
    	// Si la URL no est√° configurada, solo simulamos el guardado y salimos.
    	if (!GOOGLE_SCRIPT_URL) {
        	console.log('MODO DEMO: Simulando guardado en Google Sheets:', { sheetName, data });
        	return new Promise(resolve => setTimeout(resolve, 500));
    	}

    	// Enviamos los datos al script de Google usando el m√©todo POST.
    	const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'text/plain;charset=utf-8', // Usamos text/plain para evitar problemas de CORS con Apps Script
        },
        body: JSON.stringify({ // El cuerpo de la solicitud contiene los datos y el nombre de la hoja
            sheet: sheetName,
            data: data
        })
    	});

    	// Si la respuesta no es exitosa, lanzamos un error.
    	if (!response.ok) {
        	throw new Error('Error al guardar en Google Sheets. C√≥digo de estado: ' + response.status);
    	}

    	// Devolvemos la respuesta del script (que ser√° un JSON de √©xito o error).
    	return response.json();
	}

    // Nueva funci√≥n para guardar respuestas de evaluaci√≥n
    async function saveAnswersToSheets() {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxV6oR9z1Px-YnlbZXR-rJ04Kz-6g7A6DLMDGwg9E460EGuBnS2X5TEcScXtXN0zCrVqA/exec';
    
    // Preparar todas las respuestas con informaci√≥n de categor√≠a
    const answersArray = [];
    const categoryScoresObject = {};
    
    categories.forEach(category => {
        // Guardar el score de cada categor√≠a
        categoryScoresObject[category.id] = appState.evaluationData.categoryScores[category.id] || 0;
        
        category.questions.forEach(question => {
            const answer = appState.evaluationData.answers[question.id];
            if (answer) {
                answersArray.push({
                    questionId: question.id,
                    questionText: question.text,
                    category: category.name,
                    categoryId: category.id,  // Nuevo campo
                    value: answer
                });
            }
        });
    });
    
    const dataToSend = {
        action: 'saveAnswers',
        evaluationId: appState.companyData.id,
        companyName: appState.companyData.name,
        answers: answersArray,
        categoryScores: categoryScoresObject,  // Nuevo campo
        finalScore: appState.evaluationData.totalScore,
        maturityLevel: appState.evaluationData.maturityLevel.level
    };
    
    try {
        await fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dataToSend)
        });
        console.log('Respuestas guardadas exitosamente con puntajes por categoria');
    } catch (error) {
        console.error('Error guardando respuestas:', error);
    }
}


        function initializeEvaluation() {
            appState.evaluationData.currentCategory = 0;
            appState.evaluationData.currentQuestion = 0;
            renderCategoryProgress();
            renderCurrentQuestion();
        }

        function renderCategoryProgress() {
            const container = document.getElementById('categoryProgress');
            container.innerHTML = '';
            categories.forEach((category, index) => {
                const completed = index < appState.evaluationData.currentCategory;
                const current = index === appState.evaluationData.currentCategory;
                const item = document.createElement('div');
                item.className = `category-item ${completed ? 'completed' : ''} ${current ? 'current' : ''}`;
                item.innerHTML = `<div class="category-icon">${category.icon}</div><div><div style="font-weight: 600; font-size: 0.875rem;">${category.name}</div><div style="font-size: 0.75rem; opacity: 0.7;">${completed ? '‚úì Completado' : current ? 'En progreso' : 'Pendiente'}</div></div>`;
                container.appendChild(item);
            });
        }

        function renderCurrentQuestion() {
            const category = categories[appState.evaluationData.currentCategory];
            const question = category.questions[appState.evaluationData.currentQuestion];
            document.getElementById('categoryBadge').textContent = category.name;
            document.getElementById('categoryTitle').textContent = category.name;
            document.getElementById('categoryDescription').textContent = category.description;
            document.getElementById('questionNumber').textContent = `Pregunta ${appState.evaluationData.currentQuestion + 1} de ${category.questions.length}`;
            document.getElementById('questionText').textContent = question.text;
            document.getElementById('tooltipText').textContent = question.tooltip;
            
            const categoryProgress = ((appState.evaluationData.currentQuestion) / category.questions.length) * 100;
            document.getElementById('categoryProgressBar').style.width = categoryProgress + '%';
            
            const overallProgress = calculateOverallProgress();
            document.getElementById('overallProgress').style.setProperty('--score', overallProgress);
            document.getElementById('progressPercentage').textContent = Math.round(overallProgress) + '%';
            
            const completedCategories = appState.evaluationData.currentCategory;
            document.getElementById('progressText').textContent = `${completedCategories} de ${categories.length} categor√≠as`;
            
            renderScaleOptions(question);
            
            document.getElementById('prevBtn').disabled = (appState.evaluationData.currentCategory === 0 && appState.evaluationData.currentQuestion === 0);
            const currentAnswer = appState.evaluationData.answers[question.id];
            document.getElementById('nextBtn').disabled = !currentAnswer;
            
            if (currentAnswer) showSelectedFeedback(currentAnswer);
            else document.getElementById('selectedFeedback').classList.add('hidden');
        }

        function renderScaleOptions(question) {
            const container = document.getElementById('scaleOptions');
            container.innerHTML = '';
            const currentAnswer = appState.evaluationData.answers[question.id];
            for (let i = 1; i <= 5; i++) {
                const option = document.createElement('div');
                option.className = `scale-option ${currentAnswer === i ? 'selected' : ''}`;
                option.onclick = () => selectAnswer(question.id, i);
                option.innerHTML = `<div class="scale-number" style="background-color: ${currentAnswer === i ? scaleColors[i-1] : '#6b7280'}">${i}</div><div class="scale-label">${scaleLabels[i-1]}</div>`;
                container.appendChild(option);
            }
        }

        function selectAnswer(questionId, value) {
            appState.evaluationData.answers[questionId] = value;
            const category = categories[appState.evaluationData.currentCategory];
            const question = category.questions[appState.evaluationData.currentQuestion];
            renderScaleOptions(question);
            showSelectedFeedback(value);
            document.getElementById('nextBtn').disabled = false;
            autoSave();
        }

        function showSelectedFeedback(value) {
            const feedback = document.getElementById('selectedFeedback');
            const message = document.getElementById('feedbackMessage');
            message.textContent = `‚úÖ Has seleccionado: ${scaleLabels[value-1]}`;
            message.style.backgroundColor = scaleColors[value-1] + '20';
            message.style.color = scaleColors[value-1];
            feedback.classList.remove('hidden');
        }

        function previousQuestion() {
            if (appState.evaluationData.currentQuestion > 0) appState.evaluationData.currentQuestion--;
            else if (appState.evaluationData.currentCategory > 0) {
                appState.evaluationData.currentCategory--;
                appState.evaluationData.currentQuestion = categories[appState.evaluationData.currentCategory].questions.length - 1;
            }
            renderCategoryProgress();
            renderCurrentQuestion();
        }

        async function nextQuestion() {
            const category = categories[appState.evaluationData.currentCategory];
            
            if (appState.evaluationData.currentQuestion < category.questions.length - 1) {
                appState.evaluationData.currentQuestion++;
            } else if (appState.evaluationData.currentCategory < categories.length - 1) {
                appState.evaluationData.currentCategory++;
                appState.evaluationData.currentQuestion = 0;
            } else {
                // Evaluaci√≥n completada
                try {
                    showLoading('Calculando resultados...');
                    await calculateResults();
                    
                    showLoading('Guardando resultados en el servidor...');
                    await saveAnswersToSheets();
                    
                    hideLoading();
                    showSection('results');
                    return;
                } catch (error) {
                    hideLoading();
                    showToast('Error al procesar resultados. Los resultados se mostrar√°n de todas formas.', 'error');
                    console.error('Error:', error);
                    showSection('results');
                    return;
                }
            }
            
            renderCategoryProgress();
            renderCurrentQuestion();
        }

        function calculateCategoryScore(category) {
            let categoryScore = 0, categoryWeight = 0;
            category.questions.forEach(q => {
                const answer = appState.evaluationData.answers[q.id];
                if (answer) {
                    const questionScore = q.reverse ? (6 - answer) : answer;
                    categoryScore += (questionScore * 20 * q.weight);
                    categoryWeight += q.weight;
                }
            });
            return categoryWeight > 0 ? Math.round(categoryScore / categoryWeight) : 0;
        }

        function calculateOverallProgress() {
            const totalQuestions = categories.reduce((sum, cat) => sum + cat.questions.length, 0);
            const answeredQuestions = Object.keys(appState.evaluationData.answers).length;
            return (answeredQuestions / totalQuestions) * 100;
        }

        async function calculateResults() {
            let totalScore = 0, totalWeight = 0;
            categories.forEach(category => {
                const score = calculateCategoryScore(category);
                appState.evaluationData.categoryScores[category.id] = score;
                totalScore += score * category.weight;
                totalWeight += category.weight;
            });
            appState.evaluationData.totalScore = Math.round(totalScore / totalWeight);
            appState.evaluationData.maturityLevel = getMaturityLevel(appState.evaluationData.totalScore);
            renderResults();
        }

        async function saveEvaluationResults() {
            const resultsData = {
                companyId: appState.companyData.id, timestamp: new Date().toISOString(),
                totalScore: appState.evaluationData.totalScore, maturityLevel: appState.evaluationData.maturityLevel.level,
                categoryScores: appState.evaluationData.categoryScores, answers: appState.evaluationData.answers
            };
            if(GOOGLE_SCRIPT_URL) await saveToGoogleSheets(resultsData, 'Results');
        }

        function getMaturityLevel(score) {
            if (score <= 20) return { level: 'Inicial', description: 'Operaciones reactivas con procesos y tecnolog√≠a b√°sicos.' };
            if (score <= 40) return { level: 'En Desarrollo', description: 'Procesos estandarizados en algunas √°reas, pero con silos operativos.' };
            if (score <= 60) return { level: 'Consolidado', description: 'Estrategia definida y procesos optimizados en gran parte de la empresa.' };
            if (score <= 80) return { level: 'Avanzado', description: 'Cultura basada en datos, innovaci√≥n constante y enfoque en el cliente.' };
            return { level: 'L√≠der', description: 'Empresa √°gil, sostenible y referente en su sector por su excelencia operativa.' };
        }

        function renderResults() {
            document.getElementById('finalScore').style.setProperty('--score', appState.evaluationData.totalScore);
            document.getElementById('finalScoreNumber').textContent = appState.evaluationData.totalScore;
            document.getElementById('maturityBadge').textContent = appState.evaluationData.maturityLevel.level;
            document.getElementById('maturityDescription').textContent = appState.evaluationData.maturityLevel.description;
            renderRadarChart();
            renderDetailedResults();
            renderRecommendations();
        }
        
        let chartInstance;
        function renderRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: categories.map(c => c.name),
                    datasets: [{
                        label: 'Tu empresa', data: categories.map(c => appState.evaluationData.categoryScores[c.id] || 0),
                        fill: true, backgroundColor: 'rgba(133, 96, 192, 0.1)', borderColor: 'rgb(133, 96, 192)',
                        pointBackgroundColor: 'rgb(133, 96, 192)', pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff', pointHoverBorderColor: 'rgb(133, 96, 192)'
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, elements: { line: { borderWidth: 3 } },
                    scales: { r: { beginAtZero: true, max: 100, grid: { color: '#e5e7eb' }, pointLabels: { font: { size: 12 } } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function renderDetailedResults() {
            const container = document.getElementById('detailedResults');
            container.innerHTML = '';
            categories.forEach(category => {
                const score = appState.evaluationData.categoryScores[category.id] || 0;
                const card = document.createElement('div');
                card.className = 'card';
                card.style.borderLeft = `4px solid ${getScoreColor(score)}`;
                card.innerHTML = `<div class="card-body"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;"><div style="display: flex; align-items: center;"><div style="font-size: 1.5rem; margin-right: 0.5rem;">${category.icon}</div><h4 style="font-weight: 600; margin: 0;">${category.name}</h4></div><div style="font-size: 1.5rem; font-weight: 700; color: ${getScoreColor(score)};">${score}</div></div><div class="progress-bar" style="height: 8px; margin-bottom: 0.5rem;"><div class="progress-fill" style="width: ${score}%; background-color: ${getScoreColor(score)};"></div></div><p style="font-size: 0.875rem; opacity: 0.7; margin: 0;">${getScoreDescription(score)}</p></div>`;
                container.appendChild(card);
            });
        }

        function renderRecommendations() {
            const container = document.getElementById('recommendations');
            container.innerHTML = '';
            const recommendations = generateRecommendations();
            recommendations.forEach(rec => {
                const card = document.createElement('div');
                card.className = 'recommendation-card';
                card.innerHTML = `<div class="recommendation-priority">${rec.priority}</div><h4 style="font-weight: 600; margin-bottom: 0.5rem;">${rec.title}</h4><p style="margin-bottom: 1rem; opacity: 0.8;">${rec.description}</p><div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;"><strong>Acciones recomendadas:</strong><ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">${rec.actions.map(a => `<li>${a}</li>`).join('')}</ul></div>`;
                container.appendChild(card);
            });
        }

        function generateRecommendations() {
            const recommendations = [];
            const categoryScoreArray = categories.map(c => ({ category: c, score: appState.evaluationData.categoryScores[c.id] || 0 }));
            categoryScoreArray.sort((a, b) => a.score - b.score);
            const topCategories = categoryScoreArray.slice(0, 3);
            topCategories.forEach((item, index) => {
                const rec = getRecommendationForCategory(item.category);
                rec.priority = `PRIORIDAD ${index + 1}`;
                recommendations.push(rec);
            });
            return recommendations;
        }

        function getRecommendationForCategory(category) {
            const recs = {
                'vision_estrategia': { title: 'Fortalecer la Visi√≥n Estrat√©gica', description: 'Definir y comunicar una estrategia clara es el primer paso para alinear a toda la organizaci√≥n hacia objetivos comunes.', actions: ['Realizar un taller de planificaci√≥n estrat√©gica.', 'Documentar la visi√≥n, misi√≥n y valores.', 'Crear un plan de comunicaci√≥n interna.'] },
                'gobierno_empresarial': { title: 'Establecer un Gobierno S√≥lido', description: 'Implementar pol√≠ticas y controles claros para asegurar una toma de decisiones consistente y la rendici√≥n de cuentas.', actions: ['Definir un organigrama y roles.', 'Documentar pol√≠ticas clave (RRHH, Finanzas).', 'Establecer un comit√© de direcci√≥n.'] },
                'procesos_operaciones': { title: 'Optimizar Procesos y Operaciones', description: 'Mapear, estandarizar y automatizar los flujos de trabajo clave para mejorar la eficiencia y reducir errores.', actions: ['Realizar un mapeo de los 5 procesos principales.', 'Identificar cuellos de botella y oportunidades de automatizaci√≥n.', 'Implementar una herramienta de gesti√≥n de procesos (BPM).'] },
                'talento_cultura': { title: 'Impulsar el Talento y la Cultura', description: 'Invertir en el desarrollo del equipo y fomentar una cultura de colaboraci√≥n es clave para el √©xito a largo plazo.', actions: ['Crear un plan de capacitaci√≥n y desarrollo.', 'Implementar un sistema de evaluaci√≥n de desempe√±o.', 'Lanzar iniciativas para fomentar la colaboraci√≥n.'] },
                'innovacion_agilidad': { title: 'Fomentar la Innovaci√≥n y Agilidad', description: 'Crear un entorno que promueva la experimentaci√≥n y la adaptaci√≥n r√°pida a los cambios del mercado.', actions: ['Asignar un presupuesto para proyectos de innovaci√≥n.', 'Crear un programa de "intraemprendimiento".', 'Adoptar metodolog√≠as √°giles como Scrum o Kanban.'] },
                'estrategia_tecnologica': { title: 'Definir una Estrategia Tecnol√≥gica', description: 'Alinear la tecnolog√≠a con los objetivos de negocio y garantizar una infraestructura segura y escalable.', actions: ['Realizar una auditor√≠a tecnol√≥gica.', 'Crear un roadmap de tecnolog√≠a a 3 a√±os.', 'Implementar una pol√≠tica de ciberseguridad robusta.'] },
                'inteligencia_negocio': { title: 'Desarrollar la Inteligencia de Negocio', description: 'Convertir los datos en un activo estrat√©gico para la toma de decisiones informadas y basadas en evidencia.', actions: ['Implementar una herramienta de BI (Business Intelligence).', 'Definir los KPIs m√°s importantes para el negocio.', 'Capacitar al equipo en an√°lisis de datos b√°sico.'] },
                'experiencia_cliente': { title: 'Mejorar la Experiencia del Cliente', description: 'Poner al cliente en el centro de todas las decisiones para aumentar su satisfacci√≥n y lealtad.', actions: ['Implementar un sistema para medir la satisfacci√≥n (NPS).', 'Mapear el "customer journey" e identificar puntos de dolor.', 'Crear un protocolo de atenci√≥n al cliente.'] },
                'sostenibilidad_responsabilidad': { title: 'Integrar la Sostenibilidad', description: 'Adoptar pr√°cticas responsables que generen un impacto positivo y fortalezcan la reputaci√≥n de la marca.', actions: ['Definir una pol√≠tica de Responsabilidad Social.', 'Lanzar un programa de reducci√≥n de impacto ambiental.', 'Establecer una alianza con una causa social local.'] },
                'finanzas_rentabilidad': { title: 'Fortalecer la Gesti√≥n Financiera', description: 'Asegurar la salud financiera de la empresa a trav√©s de un control riguroso y una planificaci√≥n a largo plazo.', actions: ['Implementar un software de gesti√≥n financiera.', 'Establecer un proceso de presupuesto y control mensual.', 'Realizar un an√°lisis de rentabilidad por producto/servicio.'] }
            };
            return recs[category.id];
        }

        function getScoreColor(score) {
            if (score <= 20) return '#AA2F0C'; if (score <= 40) return '#EC8E48';
            if (score <= 60) return '#EE8028'; if (score <= 80) return '#4CCED5';
            return '#10b981';
        }
        function getScoreDescription(score) {
            if (score <= 20) return '√Årea cr√≠tica que requiere atenci√≥n inmediata';
            if (score <= 40) return 'Oportunidad de mejora significativa';
            if (score <= 60) return 'Progreso intermedio, continuar fortaleciendo';
            if (score <= 80) return 'Buen nivel, optimizar para excelencia';
            return 'Excelente desempe√±o, mantener liderazgo';
        }

async function downloadPDF() {
    const CONFIG = {
        company: {
            name: "ForjaDigitalAE",
            tagline: "Arquitectura Empresarial & Transformaci√≥n Digital",
            email: "contacto@forjadigitalae.com",
            phone: "+57 300 123 4567",
            website: "www.forjadigitalae.com",
            address: "Bogot√° D.C., Colombia"
        },
        branding: {
            primaryColor: [39, 50, 90],
            accentColor: [133, 96, 192],
            orangeColor: [238, 128, 40],
            turquoiseColor: [76, 206, 213],
            grayDark: [55, 65, 81],
            grayMedium: [107, 114, 128],
            grayLight: [243, 244, 246],
            white: [255, 255, 255],
            success: [16, 185, 129],
            warning: [245, 158, 11],
            error: [239, 68, 68]
        }
    };

    showLoading('Generando tu reporte profesional...');

    try {
        const { jsPDF } = window.jspdf;
        if (!jsPDF) throw new Error('jsPDF no disponible');

        const doc = new jsPDF('p', 'pt', 'a4');
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const margin = 50;
        const contentWidth = pageWidth - (2 * margin);

        // FUNCIONES AUXILIARES MEJORADAS
        function addWatermark() {
            doc.setGState(new doc.GState({opacity: 0.03}));
            doc.setFontSize(120);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.accentColor);
            doc.text('FORJA', pageWidth/2, pageHeight/2, {
                align: 'center',
                angle: 45
            });
            doc.setGState(new doc.GState({opacity: 1}));
        }

        function addModernHeader(pageNum) {
            // Barra superior elegante
            doc.setFillColor(...CONFIG.branding.primaryColor);
            doc.rect(0, 0, pageWidth, 60, 'F');
            
            // L√≠neas decorativas
            doc.setFillColor(...CONFIG.branding.accentColor);
            doc.rect(0, 58, pageWidth, 2, 'F');
            doc.setFillColor(...CONFIG.branding.orangeColor);
            doc.rect(0, 60, pageWidth, 2, 'F');

            // Logo/T√≠tulo compacto
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.white);
            doc.text(CONFIG.company.name, margin, 30);
            
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.text(CONFIG.company.tagline, margin, 45);

            // Info derecha
            if (pageNum > 1) {
                doc.setFontSize(7);
                doc.setTextColor(200, 200, 200);
                const date = new Date().toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' });
                doc.text(date, pageWidth - margin, 35, { align: 'right' });
                doc.text(`P√°gina ${pageNum}`, pageWidth - margin, 45, { align: 'right' });
            }
        }

        function addFooter() {
            const footerY = pageHeight - 25;
            doc.setDrawColor(...CONFIG.branding.grayLight);
            doc.setLineWidth(0.5);
            doc.line(margin, footerY - 8, pageWidth - margin, footerY - 8);
            
            doc.setFontSize(7);
            doc.setTextColor(...CONFIG.branding.grayMedium);
            const footerText = `${CONFIG.company.email} | ${CONFIG.company.phone} | ${CONFIG.company.website}`;
            doc.text(footerText, pageWidth/2, footerY, { align: 'center' });
        }

        function createScoreCircle(x, y, score, size = 80) {
            // C√≠rculo de fondo
            doc.setFillColor(...CONFIG.branding.grayLight);
            doc.circle(x, y, size/2, 'F');
            
            // C√≠rculo de score
            const scoreColor = getScoreRGB(score);
            doc.setFillColor(...scoreColor);
            doc.circle(x, y, (size/2) - 4, 'F');
            
            // Texto del score
            doc.setFontSize(size/2.5);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.white);
            doc.text(score.toString(), x, y + (size/8), { align: 'center' });
        }

        function createCompactCard(x, y, width, height, title, content, color) {
            // Sombra
            doc.setFillColor(230, 230, 230);
            doc.roundedRect(x + 2, y + 2, width, height, 8, 8, 'F');
            
            // Card principal
            doc.setFillColor(...CONFIG.branding.white);
            doc.roundedRect(x, y, width, height, 8, 8, 'F');
            
            // Borde izquierdo
            doc.setFillColor(...color);
            doc.roundedRect(x, y, 4, height, 8, 8, 'F');
            
            // T√≠tulo
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.primaryColor);
            doc.text(title, x + 15, y + 20);
            
            // Contenido
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...CONFIG.branding.grayDark);
            const lines = doc.splitTextToSize(content, width - 30);
            doc.text(lines, x + 15, y + 35);
        }

        function createMiniBarChart(x, y, width, height, data, labels) {
            const barWidth = (width - (data.length * 5)) / data.length;
            const maxValue = Math.max(...data);
            
            data.forEach((value, index) => {
                const barHeight = (value / maxValue) * height;
                const barX = x + (index * (barWidth + 5));
                const barY = y + height - barHeight;
                
                // Barra
                const color = getScoreRGB(value);
                doc.setFillColor(...color);
                doc.roundedRect(barX, barY, barWidth, barHeight, 3, 3, 'F');
                
                // Valor
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...color);
                doc.text(value.toString(), barX + barWidth/2, barY - 5, { align: 'center' });
                
                // Label
                doc.setFontSize(6);
                doc.setTextColor(...CONFIG.branding.grayMedium);
                const labelLines = doc.splitTextToSize(labels[index], barWidth);
                doc.text(labelLines[0].substring(0, 10) + '...', barX + barWidth/2, y + height + 12, { align: 'center' });
            });
        }

        function getScoreRGB(score) {
            if (score <= 20) return CONFIG.branding.error;
            if (score <= 40) return CONFIG.branding.warning;
            if (score <= 60) return CONFIG.branding.orangeColor;
            if (score <= 80) return CONFIG.branding.turquoiseColor;
            return CONFIG.branding.success;
        }

        function getScoreLevel(score) {
            if (score <= 20) return 'Inicial';
            if (score <= 40) return 'En Desarrollo';
            if (score <= 60) return 'Intermedio';
            if (score <= 80) return 'Avanzado';
            return 'Excelente';
        }

        // OBTENER DATOS
        const companyData = appState.companyData || {};
        const evaluationData = appState.evaluationData || {};
        const finalScore = evaluationData.totalScore || 0;
        const maturityLevel = evaluationData.maturityLevel || { level: 'N/A', description: 'Sin datos' };
        const categoryScores = evaluationData.categoryScores || {};

        // ===== P√ÅGINA 1: PORTADA EJECUTIVA REDISE√ëADA =====
        addModernHeader(1);
        addWatermark();
        let y = 85;

        // Hero section compacto
        doc.setFontSize(28);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('REPORTE DE MADUREZ', pageWidth/2, y, { align: 'center' });
        
        doc.setFontSize(22);
        doc.setTextColor(...CONFIG.branding.accentColor);
        doc.text('EMPRESARIAL', pageWidth/2, y + 35, { align: 'center' });
        y += 70;

        // Card de empresa compacto
        doc.setFillColor(248, 250, 252);
        doc.roundedRect(margin, y, contentWidth, 70, 10, 10, 'F');
        doc.setDrawColor(...CONFIG.branding.accentColor);
        doc.setLineWidth(1);
        doc.roundedRect(margin, y, contentWidth, 70, 10, 10, 'S');

        doc.setFontSize(16);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text(companyData.name || 'Empresa', pageWidth/2, y + 25, { align: 'center' });

        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(...CONFIG.branding.grayMedium);
        doc.text(`${companyData.sector || 'N/A'} | ${companyData.size || 'N/A'} | ${companyData.location || 'N/A'}`, pageWidth/2, y + 43, { align: 'center' });
        doc.text(`${companyData.contact?.name || 'N/A'} | ${companyData.contact?.email || 'N/A'}`, pageWidth/2, y + 58, { align: 'center' });
        y += 95;

        // Score principal con contexto
        const scoreBoxHeight = 180;
        doc.setFillColor(...CONFIG.branding.white);
        doc.roundedRect(margin, y, contentWidth, scoreBoxHeight, 10, 10, 'F');
        doc.setDrawColor(...CONFIG.branding.grayLight);
        doc.setLineWidth(2);
        doc.roundedRect(margin, y, contentWidth, scoreBoxHeight, 10, 10, 'S');

        createScoreCircle(pageWidth/2, y + 75, finalScore, 90);

        doc.setFontSize(16);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text(maturityLevel.level, pageWidth/2, y + 135, { align: 'center' });

        doc.setFontSize(8);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(...CONFIG.branding.grayMedium);
        doc.text('Nivel de Madurez Empresarial', pageWidth/2, y + 150, { align: 'center' });
        doc.text(`Puntuaci√≥n: ${finalScore}/100`, pageWidth/2, y + 165, { align: 'center' });
        y += scoreBoxHeight + 20;

        // Descripci√≥n ejecutiva compacta
        doc.setFontSize(10);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('EVALUACI√ìN EJECUTIVA', pageWidth/2, y, { align: 'center' });
        y += 20;

        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(...CONFIG.branding.grayDark);
        const description = generateCompactDescription(finalScore, maturityLevel);
        const descLines = doc.splitTextToSize(description, contentWidth - 40);
        doc.text(descLines, pageWidth/2, y, { align: 'center', maxWidth: contentWidth - 40 });
        y += descLines.length * 12 + 15;

        // M√©tricas en tres columnas
        const metricBoxWidth = (contentWidth - 20) / 3;
        const metrics = [
            { label: 'Dimensiones', value: categories.length },
            { label: 'Preguntas', value: categories.reduce((sum, cat) => sum + cat.questions.length, 0) },
            { label: 'Sector', value: companyData.sector || 'General' }
        ];

        metrics.forEach((metric, index) => {
            const metricX = margin + (index * (metricBoxWidth + 10));
            doc.setFillColor(248, 250, 252);
            doc.roundedRect(metricX, y, metricBoxWidth, 50, 6, 6, 'F');
            
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.accentColor);
            doc.text(metric.value.toString(), metricX + metricBoxWidth/2, y + 25, { align: 'center' });
            
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...CONFIG.branding.grayMedium);
            doc.text(metric.label, metricX + metricBoxWidth/2, y + 40, { align: 'center' });
        });

        addFooter();

        // ===== P√ÅGINA 2: AN√ÅLISIS COMPACTO =====
        doc.addPage();
        addModernHeader(2);
        addWatermark();
        y = 85;

        doc.setFontSize(18);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('AN√ÅLISIS POR DIMENSIONES', pageWidth/2, y, { align: 'center' });
        y += 35;

        // Gr√°fico de barras compacto
        const categoryNames = categories.map(c => c.name);
        const categoryValues = categories.map(c => categoryScores[c.id] || 0);
        
        doc.setFillColor(248, 250, 252);
        doc.roundedRect(margin, y, contentWidth, 180, 10, 10, 'F');
        createMiniBarChart(margin + 15, y + 15, contentWidth - 30, 150, categoryValues, categoryNames);
        y += 195;

        // Tabla de resultados en dos columnas
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('PUNTUACIONES DETALLADAS', margin, y);
        y += 25;

        const colWidth = (contentWidth - 10) / 2;
        let currentX = margin;
        let currentY = y;
        let columnCount = 0;

        categories.forEach((category, index) => {
            const score = categoryScores[category.id] || 0;
            const level = getScoreLevel(score);
            
            if (columnCount === 5) {
                currentX = margin + colWidth + 10;
                currentY = y;
                columnCount = 0;
            }

            // Mini card por categor√≠a
            doc.setFillColor(...CONFIG.branding.white);
            doc.roundedRect(currentX, currentY, colWidth, 35, 5, 5, 'F');
            doc.setDrawColor(...CONFIG.branding.grayLight);
            doc.setLineWidth(1);
            doc.roundedRect(currentX, currentY, colWidth, 35, 5, 5, 'S');

            // Barra de color
            const scoreColor = getScoreRGB(score);
            doc.setFillColor(...scoreColor);
            doc.rect(currentX, currentY, 4, 35, 'F');

            // Nombre
            doc.setFontSize(8);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.primaryColor);
            const nameLines = doc.splitTextToSize(category.name, colWidth - 60);
            doc.text(nameLines[0], currentX + 10, currentY + 12);

            // Score y nivel
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...scoreColor);
            doc.text(score.toString(), currentX + colWidth - 45, currentY + 15);

            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...CONFIG.branding.grayMedium);
            doc.text(level, currentX + 10, currentY + 27);

            currentY += 40;
            columnCount++;
        });

        y = Math.max(currentY, y + 220);

        // Insights clave compactos
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('INSIGHTS CLAVE', margin, y);
        y += 20;

        const insights = generateCompactInsights(categoryScores);
        insights.forEach(insight => {
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...CONFIG.branding.grayDark);
            doc.text('‚Ä¢ ' + insight, margin + 10, y);
            y += 12;
        });

        addFooter();

        // ===== P√ÅGINA 3: RECOMENDACIONES OPTIMIZADAS =====
        doc.addPage();
        addModernHeader(3);
        addWatermark();
        y = 85;

        doc.setFontSize(18);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('PLAN DE ACCI√ìN ESTRAT√âGICO', pageWidth/2, y, { align: 'center' });
        y += 30;

        // Metodolog√≠a compacta
        doc.setFillColor(247, 245, 255);
        doc.roundedRect(margin, y, contentWidth, 35, 6, 6, 'F');
        doc.setFontSize(8);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.accentColor);
        doc.text('METODOLOG√çA', margin + 15, y + 15);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(...CONFIG.branding.grayMedium);
        doc.text('Recomendaciones priorizadas por impacto vs. esfuerzo de implementaci√≥n', margin + 15, y + 27);
        y += 50;

        // Recomendaciones en dos columnas
        const recommendations = generateRecommendations();
        const recColWidth = (contentWidth - 10) / 2;

        recommendations.slice(0, 6).forEach((rec, index) => {
            const recX = margin + (index % 2) * (recColWidth + 10);
            const recY = y + Math.floor(index / 2) * 140;

            // Card de recomendaci√≥n compacto
            doc.setFillColor(235, 235, 235);
            doc.roundedRect(recX + 2, recY + 2, recColWidth, 130, 6, 6, 'F');
            doc.setFillColor(...CONFIG.branding.white);
            doc.roundedRect(recX, recY, recColWidth, 130, 6, 6, 'F');

            // Badge de prioridad
            const priorityColor = rec.priority.includes('1') ? CONFIG.branding.error :
                                rec.priority.includes('2') ? CONFIG.branding.warning :
                                CONFIG.branding.success;
            doc.setFillColor(...priorityColor);
            doc.roundedRect(recX + 10, recY + 10, 70, 16, 8, 8, 'F');
            doc.setFontSize(7);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.white);
            doc.text(rec.priority, recX + 45, recY + 20, { align: 'center' });

            // T√≠tulo
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.primaryColor);
            const titleLines = doc.splitTextToSize(rec.title, recColWidth - 20);
            doc.text(titleLines, recX + 10, recY + 35);

            // Descripci√≥n
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...CONFIG.branding.grayMedium);
            const descLines = doc.splitTextToSize(rec.description, recColWidth - 20);
            doc.text(descLines.slice(0, 2), recX + 10, recY + 55);

            // Acciones (m√°ximo 3)
            doc.setFontSize(6);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.primaryColor);
            doc.text('Acciones:', recX + 10, recY + 80);
            
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...CONFIG.branding.grayDark);
            rec.actions.slice(0, 3).forEach((action, i) => {
                const actionLines = doc.splitTextToSize('‚Ä¢ ' + action, recColWidth - 25);
                doc.text(actionLines[0].substring(0, 55) + '...', recX + 12, recY + 92 + (i * 10));
            });
        });

        y += 430;

        // Timeline compacto
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('CRONOGRAMA SUGERIDO', margin, y);
        y += 25;

        const timeline = [
            { period: 'Mes 1-2', action: 'Implementar prioridad alta', color: CONFIG.branding.error },
            { period: 'Mes 3-4', action: 'Desarrollar prioridad media', color: CONFIG.branding.warning },
            { period: 'Mes 5-6', action: 'Optimizar y consolidar', color: CONFIG.branding.success }
        ];

        timeline.forEach((item, index) => {
            const timeX = margin + (index * ((contentWidth - 20) / 3 + 10));
            doc.setFillColor(...item.color);
            doc.circle(timeX + 10, y + 10, 6, 'F');
            
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...CONFIG.branding.primaryColor);
            doc.text(item.period, timeX + 25, y + 10);
            
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...CONFIG.branding.grayDark);
            doc.text(item.action, timeX + 25, y + 22);
        });

        addFooter();

        // ===== P√ÅGINA 4: LLAMADA A LA ACCI√ìN =====
        doc.addPage();
        addModernHeader(4);
        addWatermark();
        y = 85;

        // Hero CTA
        doc.setFillColor(...CONFIG.branding.primaryColor);
        doc.roundedRect(margin, y, contentWidth, 80, 10, 10, 'F');
        
        doc.setFontSize(20);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.white);
        doc.text('¬øLISTO PARA TRANSFORMAR TU PYME?', pageWidth/2, y + 30, { align: 'center' });
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text('Este reporte es el primer paso. Ahora es momento de actuar.', pageWidth/2, y + 50, { align: 'center' });
        doc.text('Nuestro equipo puede acompa√±arte en cada etapa.', pageWidth/2, y + 65, { align: 'center' });
        y += 100;

        // Servicios en grid 2x2
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('NUESTROS SERVICIOS', pageWidth/2, y, { align: 'center' });
        y += 30;

        const services = [
            { title: 'Consultor√≠a Estrat√©gica', desc: 'Implementaci√≥n de roadmap personalizado' },
            { title: 'Optimizaci√≥n de Procesos', desc: 'Automatizaci√≥n de operaciones clave' },
            { title: 'Transformaci√≥n Digital', desc: 'Tecnolog√≠as para impulsar crecimiento' },
            { title: 'Business Intelligence', desc: 'Sistemas de datos para decisiones' }
        ];

        const serviceWidth = (contentWidth - 10) / 2;
        services.forEach((service, index) => {
            const sX = margin + (index % 2) * (serviceWidth + 10);
            const sY = y + Math.floor(index / 2) * 80;
            
            createCompactCard(sX, sY, serviceWidth, 70, service.title, service.desc, CONFIG.branding.accentColor);
        });

        y += 180;

        // CTA final destacado
        doc.setFillColor(...CONFIG.branding.accentColor);
        doc.roundedRect(margin, y, contentWidth, 60, 10, 10, 'F');
        
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.white);
        doc.text('AGENDA CONSULTA GRATUITA DE 30 MINUTOS', pageWidth/2, y + 25, { align: 'center' });
        
        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        doc.text('Analicemos los resultados y definamos el mejor camino', pageWidth/2, y + 45, { align: 'center' });
        y += 80;

        // Contacto destacado
        doc.setFillColor(...CONFIG.branding.white);
        doc.setDrawColor(...CONFIG.branding.accentColor);
        doc.setLineWidth(2);
        doc.roundedRect(margin, y, contentWidth, 80, 8, 8, 'FD');

        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...CONFIG.branding.primaryColor);
        doc.text('CONTACTO DIRECTO', pageWidth/2, y + 25, { align: 'center' });

        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(...CONFIG.branding.grayDark);
        doc.text(CONFIG.company.email, pageWidth/2, y + 45, { align: 'center' });
        doc.text(CONFIG.company.phone, pageWidth/2, y + 60, { align: 'center' });

        addFooter();

        // GUARDAR PDF
        const safeCompanyName = (companyData.name || 'Empresa').replace(/[^\w\s]/gi, '').replace(/\s+/g, '_');
        const fileName = `Reporte_Madurez_${safeCompanyName}_${new Date().getFullYear()}.pdf`;
        
        await new Promise(resolve => setTimeout(resolve, 300));
        doc.save(fileName);

        showToast('‚úÖ Reporte profesional generado exitosamente', 'success');

    } catch (error) {
        console.error('Error generando PDF:', error);
        showToast('‚ùå Error al generar el reporte', 'error');
    } finally {
        hideLoading();
    }
}

// FUNCIONES AUXILIARES ADICIONALES
function generateCompactDescription(score, maturityLevel) {
    if (score >= 70) {
        return `Con ${score} puntos, tu empresa demuestra un s√≥lido nivel de madurez empresarial. Has implementado estructuras y procesos eficientes en la mayor√≠a de √°reas evaluadas. Las recomendaciones te ayudar√°n a optimizar y alcanzar la excelencia operativa.`;
    } else if (score >= 50) {
        return `Tu puntuaci√≥n de ${score}/100 indica que est√°s en desarrollo activo. Has establecido bases operativas importantes y tienes claridad en varias √°reas. El siguiente paso es fortalecer los procesos identificados como oportunidades de mejora.`;
    } else {
        return `Con ${score} puntos, tu empresa est√° estructurando sus operaciones. Las recomendaciones priorizadas te guiar√°n para establecer fundamentos s√≥lidos que soporten el crecimiento sostenible de tu negocio.`;
    }
}

function generateCompactInsights(categoryScores) {
    const insights = [];
    const scores = Object.entries(categoryScores);
    const avgScore = scores.reduce((sum, [_, score]) => sum + score, 0) / scores.length;
    
    const topCategory = scores.reduce((max, current) => current[1] > max[1] ? current : max);
    const bottomCategory = scores.reduce((min, current) => current[1] < min[1] ? current : min);
    
    const categoryNames = {
        'vision_estrategia': 'Visi√≥n y Estrategia',
        'gobierno_empresarial': 'Gobierno Empresarial',
        'procesos_operaciones': 'Procesos y Operaciones',
        'talento_cultura': 'Gesti√≥n de Talento',
        'innovacion_agilidad': 'Innovaci√≥n y Agilidad',
        'estrategia_tecnologica': 'Estrategia Tecnol√≥gica',
        'inteligencia_negocio': 'Inteligencia de Negocio',
        'experiencia_cliente': 'Experiencia del Cliente',
        'sostenibilidad_responsabilidad': 'Sostenibilidad',
        'finanzas_rentabilidad': 'Finanzas'
    };
    
    insights.push(`Desempe√±o promedio: ${Math.round(avgScore)}%`);
    insights.push(`Fortaleza principal: ${categoryNames[topCategory[0]]} (${topCategory[1]} pts)`);
    insights.push(`Mayor oportunidad: ${categoryNames[bottomCategory[0]]} (${bottomCategory[1]} pts)`);
    
    const highScores = scores.filter(([_, score]) => score >= 70).length;
    if (highScores >= 5) {
        insights.push('Desempe√±o consistente en m√∫ltiples dimensiones');
    } else {
        insights.push('Oportunidades balanceadas de crecimiento estrat√©gico');
    }
    
    return insights;
}

function generateRecommendations() {
    const recommendations = [];
    const categoryScoreArray = categories.map(c => ({ 
        category: c, 
        score: appState.evaluationData.categoryScores[c.id] || 0 
    }));
    categoryScoreArray.sort((a, b) => a.score - b.score);
    
    const topCategories = categoryScoreArray.slice(0, 6);
    topCategories.forEach((item, index) => {
        const rec = getRecommendationForCategory(item.category);
        rec.priority = `PRIORIDAD ${index + 1}`;
        recommendations.push(rec);
    });
    
    return recommendations;
}

function getRecommendationForCategory(category) {
    const recs = {
        'vision_estrategia': { 
            title: 'Fortalecer Visi√≥n Estrat√©gica', 
            description: 'Definir estrategia clara para alinear la organizaci√≥n.',
            actions: ['Realizar taller de planificaci√≥n estrat√©gica', 'Documentar visi√≥n y valores', 'Crear plan de comunicaci√≥n interna']
        },
        'gobierno_empresarial': { 
            title: 'Establecer Gobierno S√≥lido', 
            description: 'Implementar pol√≠ticas y controles para toma de decisiones.',
            actions: ['Definir organigrama y roles', 'Documentar pol√≠ticas clave', 'Establecer comit√© de direcci√≥n']
        },
        'procesos_operaciones': { 
            title: 'Optimizar Procesos', 
            description: 'Mapear y automatizar flujos de trabajo clave.',
            actions: ['Mapear 5 procesos principales', 'Identificar cuellos de botella', 'Implementar herramienta BPM']
        },
        'talento_cultura': { 
            title: 'Impulsar Talento y Cultura', 
            description: 'Invertir en desarrollo del equipo y colaboraci√≥n.',
            actions: ['Crear plan de capacitaci√≥n', 'Implementar evaluaci√≥n de desempe√±o', 'Fomentar colaboraci√≥n']
        },
        'innovacion_agilidad': { 
            title: 'Fomentar Innovaci√≥n', 
            description: 'Crear entorno que promueva experimentaci√≥n y adaptaci√≥n.',
            actions: ['Asignar presupuesto para innovaci√≥n', 'Crear programa de intraemprendimiento', 'Adoptar metodolog√≠as √°giles']
        },
        'estrategia_tecnologica': { 
            title: 'Definir Estrategia Tecnol√≥gica', 
            description: 'Alinear tecnolog√≠a con objetivos de negocio.',
            actions: ['Realizar auditor√≠a tecnol√≥gica', 'Crear roadmap a 3 a√±os', 'Implementar ciberseguridad']
        },
        'inteligencia_negocio': { 
            title: 'Desarrollar Inteligencia de Negocio', 
            description: 'Convertir datos en activo estrat√©gico.',
            actions: ['Implementar herramienta de BI', 'Definir KPIs clave', 'Capacitar en an√°lisis de datos']
        },
        'experiencia_cliente': { 
            title: 'Mejorar Experiencia del Cliente', 
            description: 'Poner al cliente en el centro de las decisiones.',
            actions: ['Implementar NPS', 'Mapear customer journey', 'Crear protocolo de atenci√≥n']
        },
        'sostenibilidad_responsabilidad': { 
            title: 'Integrar Sostenibilidad', 
            description: 'Adoptar pr√°cticas responsables para impacto positivo.',
            actions: ['Definir pol√≠tica de RSC', 'Lanzar programa ambiental', 'Establecer alianza social local']
        },
        'finanzas_rentabilidad': { 
            title: 'Fortalecer Gesti√≥n Financiera', 
            description: 'Asegurar salud financiera con control riguroso.',
            actions: ['Implementar software financiero', 'Establecer presupuesto mensual', 'Analizar rentabilidad']
        }
    };
    
    return recs[category.id] || recs['vision_estrategia'];
}

function generateExpandedDescription(score, maturityLevel, companyData) {
    const sector = companyData.sector || 'general';
    const size = companyData.size || 'empresarial';
    
    let baseDescription = maturityLevel.description || '';
    
    // Expandir descripci√≥n seg√∫n el score
    if (score >= 85) {
        baseDescription += ` Tu empresa de ${sector} demuestra un nivel excepcional de madurez empresarial, posicion√°ndose como l√≠der en su sector. Con una puntuaci√≥n de ${score}/100, tu organizaci√≥n ha logrado implementar procesos optimizados, mantiene una cultura de innovaci√≥n s√≥lida y gestiona eficientemente sus recursos. `;
        baseDescription += `Este nivel de excelencia te permite no solo competir efectivamente en el mercado actual, sino tambi√©n anticipar y adaptarte a las tendencias futuras. Tu empresa est√° preparada para escalar y expandirse manteniendo la calidad operativa.`;
    } else if (score >= 70) {
        baseDescription += ` Con ${score} puntos, tu empresa muestra un desempe√±o s√≥lido y bien estructurado. Has logrado establecer bases fuertes en la mayor√≠a de las dimensiones evaluadas, lo que te posiciona favorablemente en el sector ${sector}. `;
        baseDescription += `Existen oportunidades espec√≠ficas de optimizaci√≥n que, al implementarse, pueden llevarte al siguiente nivel de excelencia. Tu organizaci√≥n tiene el potencial para convertirse en referente del sector.`;
    } else if (score >= 50) {
        baseDescription += ` Tu puntuaci√≥n de ${score}/100 indica que tu empresa ${size} est√° en una fase de desarrollo activo. Has establecido estructuras operativas b√°sicas y tienes claridad en varias √°reas importantes. `;
        baseDescription += `El siguiente paso es fortalecer los procesos identificados como oportunidades de mejora. Con las implementaciones correctas, puedes acelerar significativamente tu crecimiento y competitividad en el mercado.`;
    } else if (score >= 30) {
        baseDescription += ` Con ${score} puntos, tu empresa se encuentra en una etapa inicial-intermedia de madurez. Esto es com√∫n en organizaciones que est√°n estructurando sus operaciones y definiendo sus procesos clave. `;
        baseDescription += `Las recomendaciones de este reporte est√°n dise√±adas espec√≠ficamente para ayudarte a establecer fundamentos s√≥lidos que soporten el crecimiento sostenible de tu negocio.`;
    } else {
        baseDescription += ` Tu puntuaci√≥n de ${score}/100 indica que tu empresa est√° en las etapas iniciales de desarrollo estructural. Esto representa una gran oportunidad para implementar las mejores pr√°cticas desde el inicio. `;
        baseDescription += `Las recomendaciones priorizadas te guiar√°n paso a paso para establecer las bases que necesitas para un crecimiento exitoso y sostenible.`;
    }
    
    return baseDescription;
}

// FUNCIONES AUXILIARES ADICIONALES
function getMaturityLevelForScore(score) {
    if (score <= 20) return 'Inicial';
    if (score <= 40) return 'En Desarrollo';
    if (score <= 60) return 'Intermedio';
    if (score <= 80) return 'Avanzado';
    return 'Excelente';
}

function generateInsights(categoryScores) {
    const insights = [];
    const scores = Object.entries(categoryScores);
    const avgScore = scores.reduce((sum, [_, score]) => sum + score, 0) / scores.length;
    
    const topCategory = scores.reduce((max, current) => current[1] > max[1] ? current : max);
    const bottomCategory = scores.reduce((min, current) => current[1] < min[1] ? current : min);
    
    insights.push(`Tu empresa muestra un desempe√±o promedio del ${Math.round(avgScore)}% en madurez empresarial.`);
    
    const categoryNames = {
        'vision_estrategia': 'Visi√≥n y Estrategia',
        'gobierno_empresarial': 'Gobierno Empresarial',
        'procesos_operaciones': 'Procesos y Operaciones',
        'talento_cultura': 'Gesti√≥n de Talento',
        'innovacion_agilidad': 'Innovaci√≥n y Agilidad',
        'estrategia_tecnologica': 'Estrategia Tecnol√≥gica',
        'inteligencia_negocio': 'Inteligencia de Negocio',
        'experiencia_cliente': 'Experiencia del Cliente',
        'sostenibilidad_responsabilidad': 'Sostenibilidad y Responsabilidad',
        'finanzas_rentabilidad': 'Finanzas y Rentabilidad'
    };
    
    const topCategoryName = categoryNames[topCategory[0]] || topCategory[0];
    const bottomCategoryName = categoryNames[bottomCategory[0]] || bottomCategory[0];
    
    insights.push(`Tu fortaleza principal est√° en ${topCategoryName} con ${topCategory[1]} puntos.`);
    insights.push(`La mayor oportunidad de mejora se encuentra en ${bottomCategoryName} (${bottomCategory[1]} puntos).`);
    
    if (avgScore >= 80) {
        insights.push('Tu empresa muestra un nivel de madurez excelente. Enf√≥cate en mantener el liderazgo e innovaci√≥n continua.');
    } else if (avgScore >= 60) {
        insights.push('Tienes una base s√≥lida con oportunidades espec√≠ficas de optimizaci√≥n en √°reas clave.');
    } else if (avgScore >= 40) {
        insights.push('Tu empresa est√° en proceso de desarrollo. Las recomendaciones te ayudar√°n a acelerar el crecimiento.');
    } else {
        insights.push('Existen oportunidades significativas de mejora. Recomendamos implementar las acciones prioritarias.');
    }
    
    // Insight espec√≠fico sobre distribuci√≥n de scores
    const highScores = scores.filter(([_, score]) => score >= 70).length;
    const lowScores = scores.filter(([_, score]) => score <= 40).length;
    
    if (highScores >= 7) {
        insights.push('Tienes un desempe√±o consistentemente alto en la mayor√≠a de dimensiones.');
    } else if (lowScores >= 5) {
        insights.push('Se recomienda un enfoque integral ya que m√∫ltiples √°reas requieren atenci√≥n.');
    } else {
        insights.push('Tu perfil muestra fortalezas y oportunidades balanceadas para un crecimiento estrat√©gico.');
    }
    
    return insights;
}

// Extender jsPDF con roundedRect mejorado si no existe
if (window.jspdf && window.jspdf.jsPDF) {
    const { jsPDF } = window.jspdf;
    
    if (!jsPDF.API.roundedRect) {
        jsPDF.API.roundedRect = function(x, y, w, h, rx, ry, style) {
            if (typeof ry === 'undefined') ry = rx;
            
            // Crear path para rect√°ngulo redondeado
            this.lines([[w - 2 * rx, 0], [rx, 0, rx, 0, rx, ry], [0, h - 2 * ry], [0, ry, 0, ry, -rx, ry], [-w + 2 * rx, 0], [-rx, 0, -rx, 0, -rx, -ry], [0, -h + 2 * ry], [0, -ry, 0, -ry, rx, -ry]], x + rx, y, [1, 1], style || 'S', false);
            return this;
        };
    }
}

// FUNCIONES AUXILIARES ADICIONALES
function getMaturityLevelForScore(score) {
    if (score <= 20) return 'Inicial';
    if (score <= 40) return 'En Desarrollo';
    if (score <= 60) return 'Intermedio';
    if (score <= 80) return 'Avanzado';
    return 'Excelente';
}

function generateInsights(categoryScores) {
    const insights = [];
    const scores = Object.entries(categoryScores);
    const avgScore = scores.reduce((sum, [_, score]) => sum + score, 0) / scores.length;
    
    const topCategory = scores.reduce((max, current) => current[1] > max[1] ? current : max);
    const bottomCategory = scores.reduce((min, current) => current[1] < min[1] ? current : min);
    
    insights.push(`Tu empresa muestra un desempe√±o promedio del ${Math.round(avgScore)}% en madurez empresarial.`);
    
    const categoryNames = {
        'vision_estrategia': 'Visi√≥n y Estrategia',
        'gobierno_empresarial': 'Gobierno Empresarial',
        'procesos_operaciones': 'Procesos y Operaciones',
        'talento_cultura': 'Gesti√≥n de Talento',
        'innovacion_agilidad': 'Innovaci√≥n y Agilidad',
        'estrategia_tecnologica': 'Estrategia Tecnol√≥gica',
        'inteligencia_negocio': 'Inteligencia de Negocio',
        'experiencia_cliente': 'Experiencia del Cliente',
        'sostenibilidad_responsabilidad': 'Sostenibilidad y Responsabilidad',
        'finanzas_rentabilidad': 'Finanzas y Rentabilidad'
    };
    
    const topCategoryName = categoryNames[topCategory[0]] || topCategory[0];
    const bottomCategoryName = categoryNames[bottomCategory[0]] || bottomCategory[0];
    
    insights.push(`Tu fortaleza principal est√° en ${topCategoryName} con ${topCategory[1]} puntos.`);
    insights.push(`La mayor oportunidad de mejora se encuentra en ${bottomCategoryName} (${bottomCategory[1]} puntos).`);
    
    if (avgScore >= 80) {
        insights.push('Tu empresa muestra un nivel de madurez excelente. Enf√≥cate en mantener el liderazgo e innovaci√≥n continua.');
    } else if (avgScore >= 60) {
        insights.push('Tienes una base s√≥lida con oportunidades espec√≠ficas de optimizaci√≥n en √°reas clave.');
    } else if (avgScore >= 40) {
        insights.push('Tu empresa est√° en proceso de desarrollo. Las recomendaciones te ayudar√°n a acelerar el crecimiento.');
    } else {
        insights.push('Existen oportunidades significativas de mejora. Recomendamos implementar las acciones prioritarias.');
    }
    
    // Insight espec√≠fico sobre distribuci√≥n de scores
    const highScores = scores.filter(([_, score]) => score >= 70).length;
    const lowScores = scores.filter(([_, score]) => score <= 40).length;
    
    if (highScores >= 7) {
        insights.push('Tienes un desempe√±o consistentemente alto en la mayor√≠a de dimensiones.');
    } else if (lowScores >= 5) {
        insights.push('Se recomienda un enfoque integral ya que m√∫ltiples √°reas requieren atenci√≥n.');
    } else {
        insights.push('Tu perfil muestra fortalezas y oportunidades balanceadas para un crecimiento estrat√©gico.');
    }
    
    return insights;
}

// Extender jsPDF con roundedRect mejorado si no existe
if (window.jspdf && window.jspdf.jsPDF) {
    const { jsPDF } = window.jspdf;
    
    if (!jsPDF.API.roundedRect) {
        jsPDF.API.roundedRect = function(x, y, w, h, rx, ry, style) {
            if (typeof ry === 'undefined') ry = rx;
            
            // Crear path para rect√°ngulo redondeado
            this.lines([[w - 2 * rx, 0], [rx, 0, rx, 0, rx, ry], [0, h - 2 * ry], [0, ry, 0, ry, -rx, ry], [-w + 2 * rx, 0], [-rx, 0, -rx, 0, -rx, -ry], [0, -h + 2 * ry], [0, -ry, 0, -ry, rx, -ry]], x + rx, y, [1, 1], style || 'S', false);
            return this;
        };
    }
}

// --- FUNCIONES AUXILIARES NECESARIAS ---

function hexToRgbArray(hex) {
    if (!hex || typeof hex !== 'string') return [0, 0, 0];
    
    hex = hex.replace(/^#/, '');
    
    if (hex.length === 3) {
        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
    }
    
    const num = parseInt(hex, 16);
    return [
        (num >> 16) & 255,
        (num >> 8) & 255,
        num & 255
    ];
}

function getScoreColor(score) {
    if (score <= 20) return '#AA2F0C';
    if (score <= 40) return '#EC8E48';
    if (score <= 60) return '#EE8028';
    if (score <= 80) return '#4CCED5';
    return '#10b981';
}

function getMaturityInterpretation(categoryScores) {
    const scores = Object.values(categoryScores);
    const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
    
    if (avgScore <= 40) {
        return 'Tu perfil muestra oportunidades significativas de mejora. Recomendamos enfocarse en establecer procesos b√°sicos y definir una estrategia clara. Las √°reas con menor puntuaci√≥n requieren atenci√≥n prioritaria.';
    } else if (avgScore <= 70) {
        return 'Tienes una base s√≥lida con √°reas de excelencia. El enfoque debe estar en optimizar procesos existentes y fortalecer las dimensiones intermedias para lograr un crecimiento balanceado.';
    } else {
        return 'Excelente desempe√±o general. Tu empresa demuestra madurez en m√∫ltiples dimensiones. Recomendamos enfocarse en innovaci√≥n y sostenibilidad para mantener el liderazgo competitivo.';
    }
}

// Extender jsPDF con roundedRect si no existe
if (window.jspdf) {
    const { jsPDF } = window.jspdf;
    jsPDF.API.roundedRect = function(x, y, w, h, r, r2, style) {
        if (typeof r2 === 'undefined') r2 = r;
        this.rect(x, y, w, h, style);
    };
}

        function generateUUID() { return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => { const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8); return v.toString(16); }); }
        
        function autoSave() { localStorage.setItem('pymeEvaluationState', JSON.stringify(appState)); }

        function loadSavedState() {
            const saved = localStorage.getItem('pymeEvaluationState');
            if (saved) {
                const savedState = JSON.parse(saved);
                savedState.consent = appState.consent;
                appState = { ...appState, ...savedState };
                if (appState.currentSection && appState.currentSection !== 'landing') {
                    showSection(appState.currentSection);
                    if (appState.currentSection === 'evaluation') {
                        renderCategoryProgress();
                        renderCurrentQuestion();
                    } else if (appState.currentSection === 'results') {
                        renderResults();
                    }
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            showSection('landing');
            loadSavedState();
        });
		
		// Prevenir errores de recursos externos
window.addEventListener('error', function(e) {
    if (e.message.includes('claschadder') || e.message.includes('tracker')) {
        e.preventDefault();
        return false;
    }
});
    </script>
</body>
</html>